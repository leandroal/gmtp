\chapter{Análise do Projeto e do Desempenho do GMTP}
\label{cap:analisedesemp}

- COLOCAR ALGUM GRÁFICO NA PROBLEMÁTICA ENTRE O DENACAST/CoolStreaming e o NDN (provavelmente o gráfico de distorção)
- Melhorar o capítulo do GMTP em duas coisas: cabeçalho genérico e a parte de seleção dos melhores caminhos com base na capacidade atual do canal (o problema que pode ocorrer é de flash-crowd)

% 
% Com essa estratégia, possibilita-se aprofundar o entendimento sobre o GMTP em duas vertentes (projeto e desempenho), estudando-o por meio de diferentes configurações de rede e identificando-se suas vantagens e limitações em comparação ao estado da arte e da prática.

% Como apresentou-se no Capítulo~\ref{cap:introducao}, o objetivo deste trabalho compreende três grandes fases: 1) revisar as técnicas e propostas para distribuição de mídias ao vivo; 2) propor o protocolo GMTP; e 3) avaliar o uso do GMTP para distribuição de mídias ao vivo. Nos Capítulos~\ref{cap:fundamentacao} e~\ref{trabalhosrelacionados}, contemplou-se a Fase 1; no  Capítulo~\ref{cap:mudccp}, a Fase 2 e, neste capítulo, concentram-se as discussões na Fase 3.

Neste capítulo apresenta-se uma análise de projeto e avaliação de desempenho do protocolo GMTP frente às propostas Denacast/CoolStreaming~\cite{Jahromi2012,5764567} e o CCN-TV~\cite{6550523}. Considerou-se dois principais critérios de seleção dessas propostas, em comparação ao GMTP: similaridade arquitetural e as estratégias para distribuição de mídias ao vivo. Tratam-se de duas propostas que adotam a maioria das estratégias disponíveis no estado da prática/arte para o fim que se discute, referenciadas na literatura e acessíveis para estudos comparativos. Nesse contexto, considera-se que as avaliações são equânimes, pois o Denacast/CoolStreaming estende o funcionamento do CoolStreaming para dar suporte a uma estrutura P2P/CDN, o CCN-TV faz uso de uma infraestrutura que considera mais efetivamente o suporte da rede para otimizar o acesso aos dados e o GMTP essencialmente explora uma estratégia híbrida considerando-se estes concorrentes.

Primeiramente, na Seção~\ref{sec:projeto-gmtp}, analisa-se o projeto GMTP no tocante aos seus benefícios e funcionalidades, bem como uma comparação de projeto (arquitetura e modelo de serviço) frente ao Denacast/CoolStreaming e o CCN-TV. Em seguida, inicia-se a fase de avaliação do GMTP. Primeiramente, na Seção~\ref{sec:metodologia}, apresenta-se a metodologia de avaliação de desempenho do GMTP. Em seguida, na Seção~\ref{sec:resdisc}, estabelecem-se confrontos entre o GMTP e os sistemas supracitados, apresentando-se os resultados e discussões dos sistemas estudados.  Por fim, na Seção~\ref{sec:resdisc-sumario}, apresenta-se o sumário deste capítulo.

\section{Análise do Projeto}
\label{sec:projeto-gmtp}

Após apresentar detalhes do protocolo GMTP no Capítulo~\ref{cap:mudccp}, nesta seção, objetiva-se justificar a proposta do GMTP não apenas como um protocolo com o apelo de reduzir a complexidade dos recursos disponibilizados na camada de aplicação e interoperabilidade, mas também apresentar que um conjunto mínimo de serviços, quando organizados de forma mais apropriada (nas camadas inferiores), tornam-se equivalentes aos recursos dos atuais sistemas, promovendo-se melhorias substanciais tanto no projeto das aplicações quanto no uso dos recursos de rede. A consequência disso é um melhor serviço de rede que pode ser ofertado à camada de aplicação e a própria extensibilidade do protocolo (evolução da solução).

Nesse contexto, organizou-se esta seção em duas partes. Primeiramente, analisa-se as funções do GMTP e os consequentes benefícios e, em seguida, apresenta-se uma comparação de projeto entre o GMTP, o Denacast/CoolStreaming e o CCN-TV. Este entendimento permitirá o melhor entendimento dos resultados apresentados na avaliação de desempenho do GMTP, a partir da Seção~\ref{sec:metodologia}.

\subsection{Arquitetura e modelo de serviço do GMTP}

% \begin{figure}
% \begin{center}
% \includegraphics[natwidth=664,natheight=340,scale=.61]{imgs/gmtp-servicos-sistemas.png}
% \end{center}
% \vspace{-1cm}
% \caption{\textit{Backbone} da Rede Nacional de Pesquisa (RNP). 27 pontos de presença, um em cada estado brasileiro, com 22 pontos de troca de tráfego. Extraída de http://www.rnp.br/.}
% \label{fig:gmtp-servicos-sistemas}
% \end{figure}

Como já apresentado na problemática deste trabalho, os sistemas de distribuição de mídias ao vivo enfrentam problemas que acarretam os seguintes requisitos de aplicação, cada um com seus desafios: melhor forma para permitir conexão multi-ponto e tratamentos de diferentes topologias, de realizar seleção de nós parceiros e tolerar falhas, bem como outros problemas causados pelo dinamismo da rede, disponibilizar informação de contexto sobre a rede para dar suporte à execução dos serviços das aplicações (localização da rede, medições de custos entre redes), incentivar à cooperação entre nós, inibir a participação de nós \textit{free-riders}, adaptar o fluxo de dados baseado na capacidade de recepção dos nós e promover segurança, por exemplo, contra ataques de poluição.

Ao observar esses requisitos, cada um com seus desafios, enumeram-se $7$ principais benefícios promovidos pelo GMTP, tanto para os sistemas de distribuição de mídias ao vivo quanto para a rede, relacionando-os com os recursos atualmente empregados nos sistemas de distribuição de mídias ao vivo.

\begin{enumerate}

  \item \textit{Otimização arquitetural:} das aplicações existentes... cliente/servidor, p2p/cdn... usar a palavra automático para criação de canais multicast, inclusive entre diferentes domínios administrativos, uso transparente de estratégias de redes de favores e cdn

  \item \textit{Interoperabilidade entre sistemas:} conexão, unifica... unifica as aplicações clientes no ponto de vista do processo de conexão e obtenção dos dados, uma vez que todo esse processo ocorre na camada de transporte sem qualquer influência da aplicação. Isto significa que se existir um nó executando um cliente do sistema PPLive e um outro cliente do sistema SopCast, portanto desenvolvido por equipes diferentes, ambos ainda sim serão compatíveis e capazes de cooperar entre si na obtenção do fluxo de mídia de interesse comum; "Arquiteturalmente, o GMTP resolve o problema de permitir a interoperabilidade dos sistemas e otimiza o uso de recursos de rede ..."

  \item \textit{Facilidade na integração:} das aplicações existentes... falar da api socket

  \item \textit{Melhor utilização dos recursos de rede:} controle de congestionamento assistido pela rede, tragédia dos bens comuns...

  \item \textit{Flexibilidade de uso:} gmtp-inter gmtp-intra extensibilidade, o cara pode fazer um novo gmtp-intra e usar tudo do gmtp-inter

  \item \textit{Eliminação de recursos paliativos e fenômenos consequentes:} das aplicações por quê? pegar a lista abaixo e meter o pau!

  \item \textit{Generalização de boas práticas e abstração da complexidade:} citar o que era de aplicação e foi pra dentro do GMTP. - O GMTP não é um protocolo multicast fim-a-fim, mas usa multicast na rede local: evitar problemas de integração (ver se isso fica nesse item)

\end{enumerate}

\subsection{Comparativo: GMTP, Denacast/CoolStreaming e CCN}

\subsubsection{GMTP vs. Denacast/CoolStreaming:}

\begin{enumerate}

  \item O conceito de sub-fluxo adiciona complexidade à solução sem
necessariamente resultado em melhor desempenho. Em~\cite{4509752}, os autores
do CoolStreaming discutem que aumentar a quantidade de número de sub-fluxos não
melhora proporcionalmente algumas métricas, como o índice de continuidade e
utilização da capacidade de \textit{upload} dos nós transmissores (em média). Os autores
executaram simulações com 40 mil nós e 24 servidores auxiliares (que
funcionaram apenas como nós transmissores) e observaram que a partir de 8
sub-fluxos, as duas métricas citadas anteriormente não evoluem positivamente, piorando em alguns casos (quando se utiliza nós com capacidade heterogêneas de transmissão). No GMTP, utiliza-se sempre o método \textit{push} após um nó estabelecer uma conexão e os roteadores no caminho entre o nó servidor e o nó cliente podem interceptar os pedidos de conexão transmitidos por outros nós clientes. Essa estratégia reduz a quantidade de requisições ao servidor e o tempo para iniciar a reprodução de um vídeo ao usuário final (apenas o primeiro usuário perceberá um atraso maior do que os demais). Com isso, se no caminho entre o nó cliente e o nó servidor não ocorrer nenhuma interceptação, a
requisição alcançará o nó servidor, e a troca de dados ocorrerá normalmente. Em seguida, os próximos nós clientes que transmitirem pedidos de conexão e o pacote de requisição for roteado através de pelo menos parte do mesmo caminho já utilizado anteriormente, um nó servidor instruirá um roteador nesse caminho a replicar o fluxo para o novo nó cliente, em vez de responder com a aceitação do pedido de conexão.

  \item No sistema CoolStreaming, a rede de sobreposição é centrada no dado. Os
nós realizam parcerias considerando quais parceiros possuem as partes da mídia
de interesse e a mudança de parcerias ocorre ao longo da transmissão. Isso gera
instabilidades na transmissão, impactando diretamente em métricas como o índice
de continuidade. Além disso, as parcerias são efetivadas independente da posição
do nó na rede de sobreposição, levando-se em consideração apenas o nó que detém um
determinado contéudo de interesse e sua capacidade de \textit{upload}, o que pode gerar
sobrecarga na troca de informações de controle. No GMTP, a rede de sobreposição
é centrada na conexão e a constituição de tal rede ocorre de forma transparente
à aplicação. A formação da rede acontece no processo de pedido de conexão, onde
os nós intermediários (roteadores), localizados entre o nó interessado pela
mídia (cliente) o nó transmissor (servidor), são autorizados a interceptar o
pedido de conexão e responder ao nó cliente como se fosse o servidor original.
Somente depois dessa fase, os nós roteadores GMTP iniciam um processo de
expansão de parcerias, onde podem realizar parcerias com outros nós que não
estejam, necessariamente, conectados em um mesmo servidor da CDN.

  \item Os nós da rede de sobreposição do sistema CoolStreaming são os sistemas
finais, que executam aplicações de rede. No GMTP, constitui-se uma rede de
sobreposição entre os roteadores e não entre os sistemas finais. Dessa
forma, a rede se torna estável com relação a dinâmica de entradas e saídas de nós clientes, sendo possível continuar utilizando temporariamente os recursos de um roteador, mesmo quando seus nós clientes desistem de continuar obtendo a mídia de interesse (se o usuário fechar o aplicativo, por exemplo).

  \item Um nó recém integrado à rede DONet pode levar muito tempo (em alguns
casos 20 segundos) para obter os primeiros blocos de vídeo e assim iniciar a
reprodução do conteúdo ao usuário final. Isto porque, ao se juntar à rede, um
nó solicita o mapa de \textit{buffer} a um conjunto de nós parceiros informados
por um servidor de \textit{boostrap}. Porém, o desafio é definir a partir de
qual ponto do \textit{buffer} um nó deve começar a solicitar os blocos de
vídeo. Por exemplo, se o novo nó requisitar um bloco de vídeo muito antigo, pode ser que tal bloco de vídeo não esteja mais disponível, já que o nó cliente o remove após sua reprodução. Por outro lado, se o nó requisitar um bloco de vídeo muito recente, pode ser que nenhum de seus nós parceiros tenha disponível. No GMTP, situações como essas não ocorrem porque se utiliza, por padrão o método \textit{push}, além do mais, as últimas partes da mídia já podem estar disponíveis no roteador, quando há outros clientes anteriores recebendo o fluxo de dados correspondente. Outras decisões nesse sentido foram tomadas no GMTP, em destaque no Capítulo~\ref{cap:mudccp}.

  \item A seleção de nós no sistema CoolStreaming ocorre com base na escolha
aleatória de um sub-conjunto de nós disponíveis em uma lista de parceiros. Após
realizar parcerias com um sub-conjunto de nós, um nó começa a receber os blocos
de vídeo, ao mesmo tempo que monitora o status de recepção dos sub-fluxos,
transmitidos por diferentes nós parceiros. Quando um nó percebe que a taxa de
recepção não está satisfatória, inicia-se um processo para selecionar novos nós
parceiros. A grande questão é definir quando, de fato, a taxa de recepção não
está sendo suficiente. Para isso, monitora-se o \textit{buffer} de recepção dado um sub-fluxo $j$ transmitido por um nó $C_{1}$ ao nó $C_{2}$, observando as inequações~\ref{eq:coolstreaming-substream-monitor1}
e~\ref{eq:coolstreaming-substream-monitor2},

  \item A estratégia de seleção de nós aplicado no CoolStreaming é muito complexa
porque exige o monitoramento constante dos buffers dos sub-fluxos, o que
implica em exaustivas trocas de mapa de \textit{buffer}, dependendo da
quantidade de nós no conjunto $parents$ e $partners$ para um dado nó $C_2$. A
consequência disso é um aumento expressivo de pacotes de controle entre os nós parceiros e seus nós pais, além da transmissão de pacotes de dados contendo as partes da mídia. No GMTP, as parcerias são formadas de uma forma bastante diferente, que basicamente consiste em envolver um algoritmo de controle de congestionamento assistido pela rede, que compartilha a sua capacidade de transmissão em um determinado instante \textit{t}. Dessa forma, tanto um nó receptor quanto o nó transmissor conhecem a capacidade máxima de transmissão no canal que separa ambos. Sendo assim, o nó transmissor ajusta sua taxa de transmissão em direção ao nó receptor de acordo com a taxa de transmissão disponível em qualquer pacote de dados. Como já se sabe, no GMTP, os nós são os roteadores de rede, que simplesmente repassam para os clientes os fluxos de dados que contém partes da mídia. Esse assunto será retomado no próximo capítulo.


DENACAST: No ponto de vista da rede P2P, as considerações sobre o sistema Denacast são similares ao caso do CoolStreaming. Com relação a arquitetura geral, o Denacast
tem uma melhor organização da rede de sobreposição devido ao uso de servidores
de uma rede CDN. Isto permite um melhor agrupamento dos nós em uma determinada
região da rede (delimitada pela localização do nó servidor da CDN). Nesse
sentido, o Denacast escala melhor o número de nós e melhora as métricas de
qualidade de serviço relacionadas à transmissão de uma mídia ao vivo se
comparado ao CoolStreaming~\cite{Jahromi2012,5764567}.

O Denacast é o sistema que mais se aproxima ao GMTP, devido a sua estratégia de
unir diferentes redes de malha quando a quantidade de nós em uma determinada
rede extrapola um determinado limite. Porém, como já foi discutido na
Seção~\ref{subsec:coolstreaming}, em discussão sobre o CoolStreaming e que se
estende ao Denacast, o GMTP oferece funções diferenciadas e detalhadas no
Capítulo~\ref{cap:mudccp}. Por esse motivo, reserva-se um discussão mais detalhada sobre o Denacast em confronto com o GMTP para o Capítulo~\ref{cap:analisedesemp}. 


Com relação a arquitetura de rede ICN, em especial a NDN, e o GMTP, enumeram-se as seguintes comparações:

\end{enumerate}

\subsubsection{GMTP vs. Denacast/CoolStreaming:}

\begin{enumerate}

  \item ESSA VAI PARA DISCUSSÃO SOBRE PROJETO GMTP Como discutiu-se no Capítulo~\ref{cap:introducao}, as aplicações de transmissão de mídias ao vivo possuem algumas peculiaridades que precisam ser tratadas nas camadas abaixo da aplicação, sendo praticamente impossível generalizar uma infraestrutura que sirva para fluxos de dados elásticos e inelásticos. Em geral, as redes ICN estão tendendo a considerar sua arquitetura mais genérica possível para permitir diferentes padrões de tráfego, mas isso não é trivial. Por outro lado, no GMTP, decidiu-se partir dos requisitos específicos dos sistemas de distribuição de mídias ao vivo e questionar sobre quais funções que se utilizam nesses sistemas que podem ser generalizadas pela rede. Sendo assim, o GMTP adiciona à rede IP, originalmente proposta para transportar fluxos de dados em sua maioria elásticos, a capacidade de prover funções comuns a todas as aplicações que transmitem fluxos de dados inelásticos.

  \item PARA PARA AVALIAÇÃO E PARTE PARA PROJETO: Como consequência do item anterior, a rede NDN transmite mais pacotes de controle do que o GMTP por ter uma proposta de modelo de serviço mais genérico, baseado em \textit{pulling}. No GMTP, propõe-se um modelo de serviço híbrido \textit{push-pull}. Por ter um modelo de serviço mais específico para sistemas de distribuição de mídias ao vivo, no GMTP o mecanismo de \textit{cache} das partes de uma mídia é mais simples de se implementar, pois utiliza-se uma estrutura de \textit{buffer} circular, substituindo-se as partes da mídia à medida que se recebe as subsequentes, sem a necessidade do roteador transmitir, a todo instante, o equivalente ao que seria um pacote de interesse -- o conceito de pacote de interesse da NDN não existe para o GMTP. Em CCN, um dos grandes desafios é definir quanto tempo um dado deve permanecer em \textit{cache}. Um outro desafio é determinar se o dado em \textit{cache}, principalmente em aplicações elásticas, ainda é válido. Todas essa funções, aumentam a sobrecarga de controle nas redes ICN e, como já se sabe, em redes IP essas questões não é um problema. O GMTP apenas instrui os roteadores a realizar uma política mais sofisticada de repasse quando um pacote de dados é alocado na fila de roteamento, aproveitando a oportunidade de repassar o mesmo pacote em rotas adicionais, de acordo com a demanda.

%   \item Em ICN, especialmente em NDN, ainda não se sabe qual tratamento será feito caso nós maliciosos realizem um ataque de negação de serviço distribuída ao inundar os roteadores transmitindo demasiadamente 

  \item PROJETO: Para executar as aplicações de rede existentes na Internet sobre uma rede ICN, serão necessárias alterações mais específicas nos sistemas de transmissão de mídias ao vivo. Em ICN, faz-se necessário que todas as aplicações mudem a lógica de requisição das partes da mídia, sendo necessário também alterar o esquema de identificação do conteúdo de interesse, que passa a ser por nome e não mais por endereço IP e número de porta. Além disso, há uma inversão na forma que uma aplicação obtém os dados quando se utiliza NDN. Em NDN, o nó cliente controla praticamente todos as funções de transporte de dados, como controle de perda/erro, controle de congestionamento e fluxo etc. Entretanto, atualmente, um nó cliente para obter um conteúdo multimídia, estabelece uma conexão informando implicitamente que deseja receber aquele fluxo, pois o endereço IP e porta já define indiretamente qual é o conteúdo. Ao perceber essa relação implícita, no GMTP, praticamente não será necessário alterar a aplicação, apenas mudar o valor do parâmetro do protocolo de transporte atual (em geral, UDP), pelo valor do protocolo GMTP. No GMTP, extrapola-se os limites da constituição de uma rede P2P na camada de aplicação. Em vez das aplicações realizarem tal função, os próprios roteadores realizam as parcerias entre si, ocorrendo no contexto de execução do GMTP. Com isso, não se delega à aplicação qualquer atividade específica sobre obtenção do conteúdo de interesse, seleção de nós, controle de congestionamento e definição de canais multicast. O esquema de requisição continua o mesmo, ou seja, os sistemas finais solicitam o conteúdo por endereço IP e porta, com a diferença que o GMTP internamente gera um nome (\textit{hash}) combinando esses dois parâmetros, utilizando-o para implementar funções de compartilhamento de um mesmo fluxo de dados ao vivo e instruir os roteadores que realizem parcerias determinadas parcerias.



  \item No ICN, o mecanismo que determina a interceptação de um pacote de interesse é limitado a verificação local se o fluxo de dados já está sendo recebido ou não, sem qualquer auxílio de qualquer outro nó. Por exemplo, no NDN, o nó servidor tem um papel coadjuvante, apenas respondo pacotes de dados quando recebe um pacote de interesse, sem manter estado de conexão. No GMTP, o nó servidor tem um papel importante no processo de distribuição ao auxiliar a rede a decidir qual é a melhor rota para obter um fluxo de dados com base na interceptação de duas ou mais rotas conhecidas. De fato, há uma troca de serviços, pois o roteador também auxilia o servidor informando qual deve ser sua taxa ideal de transmissão. Já o auxilio do servidor à rede ocorre porque no procedimento de conexão do GMTP, registra-se no pacote de pedido de conexão, os identificadores de cada roteador. Esse identificador é único em toda rede e gerado pela combinação dos endereços MAC de todas as interfaces de rede. Ao receber um pacote de pedido de conexão, o nó servidor conhece por quais roteadores o pacote passou e então sugere a intersecção de outros caminhos já conhecidos, se possível, caso contrário, responde normalmente ao nó cliente.

  \item Nas redes ICN, ainda não é claramente definido o uso de soluções mais robustas de controle de congestionamento, sendo o foco das propostas em algoritmos tradicionais baseado em janelas deslizantes ou similares. Em diversas pesquisas recentes, demonstrou-se que utilizar os roteadores de rede para auxiliarem os sistemas finais no processo de controle de congestionamento, obtêm-se um melhor desempenho da rede, reduzindo-se o atraso e finalizando-se mais rapidamente os fluxos de curta duração, bem como permitindo o compartilhamento mais equânime dos recursos de rede. No GMTP, optou-se por utilizar tal abordagem, ainda estendendo-a ao permitir que o nó servidor sugira aos roteadores quais parcerias devem ser efetivadas, baseando-se na capacidade atual de transmissão dos canais conhecidos. Já nas ICNs, com pôde-se constatar, as pesquisas do estado da arte estão concentradas em fazer com o que o nó servidor disponibilize múltiplos fluxos de dados codificados em diferentes \textit{bit-rates}, ao passo que os nós clientes devem monitorar sua capacidade de recepção e requisitar o fluxo apropriado. Porém, monitorar a capacidade de transmissão dos sistemas finais baseado apenas nas perdas de dados e atraso não é uma solução efetiva devido à dinâmica de entrada e saída dos nós da rede (\textit{churn}).

  \item Em NDN, requisitar cada pacote de dados pode introduzir uma significativa sobrecarga à rede, devido ao uso de largura de banda para transmitir a quantidade de pacotes de interesse igual à quantidade de pacotes de dados, aumentando a ocupação dos \textit{buffers} dos roteadores. Como consequência, a rede NDN pode apresentar problemas de desempenho e escalabilidade, podendo apresentar significativos níveis de congestionamento. Para sistemas de distribuição de mídias ao vivo, isto pode ser ainda mais grave, pois estão sujeitos às condições de rede do canal de \textit{upload} (do nó receptor ao nó transmissor, já que o nó cliente controla os serviços de transporte). Sendo assim, em caso de congestionamento no canal de \textit{upload}, os pacotes de interesse podem sofrer atrasos ou descartes. Consequentemente, a rede não será capaz de transmitir os pacotes de dados correspondentes em tempo hábil ou nunca transmitir, caso o pacote de dado correspondente expire no cache de todos os roteadores, levantando questões sobre qual é o melhor momento de desistir de requisitá-lo e requisitar o próximo. Sendo assim, mesmo em cenários onde o canal de \textit{download} esteja livre, os nós receptores podem experimentar uma baixa qualidade de serviço devido às perdas de pacotes de interesse, não necessariamente de pacotes de dados. Esses cenários são típicos em serviços de conexões residenciais, onde os \textit{enlaces} são geralmente assimétricos em termos de largura de banda, por exemplo, ADSL. Atualmente, existe um estudo sobre introduzir uma função chamada de agregação de pacotes de interesse~\cite{6691438}. Nesse caso, um único pacote de interesse agregaria a requisição de múltiplos pacotes de dados. Entretanto, essa proposta ainda não é oficial e acarreta em outro problema. Por exemplo, a perda de um pacote de interesse agregado resultará na perda de múltiplos pacotes de dados, impactando diretamente na qualidade de serviço de uma aplicação de transmissão de mídia ao vivo. No ponto de vista prático, o usuário experimentará uma rajada de perda de pacotes de dados e a reprodução contínua será comprometida. Além disso, os pacotes de dados em NDN tem MTU de \ut{8800}{bytes} ou de \ut{4096}{bytes}, ao passo que em redes IP utiliza MTU, em geral, de \ut{1500}{bytes}, ou seja, uma perde de um único pacote em NDN, perde-se mais dados de aplicação se comparado às redes IP.

\end{enumerate}

===================================================
===================================================

- isso é tão verdade que na próxima seção serão comparadas uma aplicação gmtp, com um sistema proeminente atualmente e um sistema que segue uma proposta de uma arquitetura futura da internet.


\section{Avaliação de Desempenho}
\label{sec:metodologia}

Para realizar a comparação entre os sistemas supracitados, definiu-se a modalidade experimental em um ambiente de simulação de rede. Através da definição de uma topologia de rede que se aproxima do mundo real, variáveis independentes e fatores, mediu-se e analisou-se as principais métricas (variáveis dependentes) que determinam a satisfação do usuário ao assistir a um evento através de um sistema de distribuição de mídias ao vivo. Para isto, realizou-se um estudo detalhado do comportamento do GMTP, estudando-o em diferentes configurações de rede a fim de determinar suas vantagens, limites e os impactos que seus recursos podem gerar tanto sobre os nós quanto sobre a rede.

A seguir, apresentam-se detalhes do projeto experimental executado, organizado em objetivo e hipótese, topologia de rede, variáveis e fatores, população e amostras, tratamentos, instrumentação e formato da mídia.

\subsection{Objetivo e hipótese}
\label{subsec:objetivo-hipotese}

O objetivo do experimento foi avaliar o desempenho do GMTP com vistas à hipótese enunciada de que a constituição de uma rede de favores entre roteadores que interceptam, realizam \textit{cache} temporário e compartilham pacotes de dados tanto em modo \textit{multicast} (em redes locais) quanto em modo unicast (entre redes distintas), auxiliados por um algoritmo para controle de congestionamento assistido pela rede, resulta em uma melhor distribuição dos fluxos de mídias ao vivo.

Para provar esta hipótese, organizou-se a avaliação experimental em duas etapas. Na primeira etapa, confrontou-se o GMTP com o Denacast/CoolStreaming e, na segunda, confrontou-se o GMTP com o CCN-TV. Em ambas as etapas, analisaram-se os valores obtidos referentes às métricas que determinam a qualidade de serviço dos sistemas de distribuição de mídias ao vivo, comparando-se o desempenho dos sistemas estudados.

% Em cada etapa, definiu-se uma hipótese nula ($H_0$) e uma hipótese alternativa ($H_A$), da seguinte forma:
% 
% \begin{enumerate}
% 
%   \item \textit{GMTP vs. Denacast/CoolStreaming}:
%   \begin{itemize}
% 
%     \item $H_0$: a eficácia do GMTP e a do Denacast/CoolStreaming é igual, considerando-se as métricas que determinam a qualidade de serviço para distribuição de mídias ao vivo.
% 
%     \item $H_A$: a eficácia do GMTP e do Denacast/CoolStreaming é diferente, considerando-se as métricas que determinam a qualidade de serviço para distribuição de mídias ao vivo.
% 
%   \end{itemize}
% 
%   \item \textit{GMTP vs. CCN/TV}: 
%   \begin{itemize}
% 
%     \item $H_0$: a eficácia do GMTP e do CCN-TV é igual, considerando-se as métricas que determinam a qualidade de serviço para distribuição de mídias ao vivo.
% 
%     \item $H_A$: a eficácia do GMTP e do CCN-TV é diferente considerando-se as métricas que determinam a qualidade de serviço para distribuição de mídias ao vivo.
% 
%   \end{itemize}
% 
% \end{enumerate}



\subsection{Topologia de rede}
\label{subsec:topologia}

Com esse norte, definiu-se a topologia da rede, como ilustra-se na Figura~\ref{fig:rede-geant}. Simulou-se uma versão resumida da rede GÉANT\footnote{Rede GÉANT é a rede de pesquisa e educação pan-europeia, que interliga as Redes Nacionais de Pesquisa e Educação da Europa (NRENs) atualmente com 41 roteadores: http://www.geant.net/.}, composta por 27 roteadores. No Apêndice~\ref{app:detalhes-experimentos}, Seção~\ref{sec:tabela-atrasos-propagacao-rede}, apresentam-se as configurações de cada roteador e seus enlaces no tocante à largura de banda e atraso de propagação, com base na legenda da Figura~\ref{fig:rede-geant}.

\begin{figure}[b!ht]
\begin{center}
\includegraphics[natwidth=1729,natheight=1190,scale=.51]{imgs/rede-geant1.png}
\end{center}
\vspace{-0.8cm}
\caption{Versão resumida do \textit{backbone} da rede GÉANT.}
\label{fig:rede-geant}
\end{figure}

Com relação à conectividade dos nós clientes à rede, simulou-se redes locais através das quais os nós cliente estabeleceram conexões com os servidores. O objetivo foi simular redes institucionais (empresas, escolas, pequenos provedores, etc) e, para isto, gerou-se $27$ sub-grafos aleatórios de um grafo completo, com $12$ vértices (nós roteadores) e estabeleceu-se uma aresta entre dois vértices (enlace entre roteadores) da seguinte forma: iterou-se os $12$ roteadores dois-a-dois, sorteando-se um número \textit{x} $\in$ $[0,1]$. Com base no valor de \textit{x}, decidiu-se com probabilidade de \ut{60}{\%} estabelecer um enlace entre os dois roteadores correspondentes à cada iteração. Além disso, assegurou-se o estabelecimento de pelo menos um enlace para cada roteador e determinou-se uma largura de banda de \ut{100}{Mbps} e atraso de propagação de \ut{1}{ms} entre todos os enlaces da rede local. Em seguida, para cada roteador do \textit{backbone}, estabeleceu-se um enlace de \ut{100}{Mbps} com um dos roteadores de uma das redes locais (escolhida aleatoriamente dentre as $27$ geradas).

Por fim, os nós clientes foram distribuídos nas redes locais de forma sequencial, um para cada roteador até distribuir todos os clientes nas redes locais. Por exemplo, supondo-se um tratamento com $500$ nós clientes, o nó cliente $1$ foi conectado ao nó roteador $1$, o nó cliente $2$ foi conectado ao nó roteador $2$ e assim sucessivamente até atingir o $27^o$ roteador (conectando-se o nó cliente $27$), recomeçando-se a contagem do número de roteadores até atingir o número máximo de nós clientes determinado no respectivo tratamento. Desta forma, todos os sistemas foram submetidos às mesmas condições de distribuição dos nós cliente.

Como resultado dessa estratégia, simulou-se uma rede constituída por $324$ roteadores, utilizada na execução de todos os tratamentos do experimento. Com isto, garantiu-se que todos os sistemas avaliados fossem submetidos à mesma topologia de rede e distribuiçãod os nós clientes.

\subsection{Definição das variáveis e parâmetros dos sistemas estudados}
\label{subsec:variaveis}

As variáveis foram definidas em 3 categorias: independentes, fatores e dependentes.

\subsubsection{Variáveis independentes:}

Na Tabela~\ref{tb:variaveis-independentes}, apresentam-se as variáveis independentes utilizadas no experimento, com base na topologia da rede apresentada anteriormente.

\begin{table}[b!ht]
  \centering
  \caption{Tabela das variáveis independentes utilizados no experimento.}
  \renewcommand{\arraystretch}{1}% Spread rows out...
  \begin{tabular}{>{}m{2.8in} >{}m{3.1in}}
    \toprule
    \textbf{Parâmetros} & \textbf{Valores} \\
    \midrule
    Dinâmica da rede (\textit{churn})$^1$ & RandomChurn \\
    Número de nós roteadores (\textit{backbone}) & 27 \\
    Número de nós roteadores nas redes locais & 12 \\
    Número total de roteadores & 324 \\
    Largura de banda das redes locais & \ut{100}{Mbps} \\
    Atraso de propagação das redes locais & \ut{1}{s} \\
    Tempo de simulação de cada ensaio & \ut{900}{s} \\
    Tamanho do buffer circular (roteadores) & \ut{40}{s} \\
    Tamanho máximo do datagrama & \ut{1500}{Bytes} (OverSim) e \ut{4096}{Bytes} (CCNSim)\\
    Taxa de upload dos nós & \ut{512}{Kbps}, \ut{1}{Mbps}, \ut{2}{Mbps} (Heterogênea) \\
    Tipo da mídia$^2$ & MPEG4 Part I \\
    \bottomrule
  \end{tabular}
  \\\scriptsize\raggedright
  $^1$ Para mais detalhes, consultar Seção~\ref{subsec:tratamento}. \\
  $^2$ Para mais detalhes, consultar Seção~\ref{subsec:tipomidia}.\\
  \normalsize
  \label{tb:variaveis-independentes}
\end{table}

\subsubsection{Fatores:}

Na Tabela~\ref{tb:fatores}, apresentam-se os fatores considerados no experimento. Os tratamentos foram determinados pelo produto cartesiano desses fatores.

\begin{table}[b!ht]
  \centering
  \caption{Tabela dos fatores consideradas no experimento.}
  \renewcommand{\arraystretch}{1}% Spread rows out...
  \begin{tabular}{>{}m{2.2in} >{}m{3.6in}}
    \toprule
    \textbf{Fatores} & \textbf{Valores} \\
    \midrule
    Número de nós servidores & 1, 3, 5 \\
    Número de nós clientes$^1$ & 500; 1.500; 15.000; 30.000; 60.000; 80.000 \\
%     Suporte da rede ao protocolo$^2$ & Borda e Total \\
    \bottomrule
  \end{tabular}
  \scriptsize\raggedright
  \begin{spacing}{0.5}
    $^1$ Todos os clientes solicitaram a mídia nos primeiros \ut{200}{s} de cada ensaio. Mais detalhes na Seção~\ref{subsec:tratamento}.
%     $^2$ Apenas no confronto GMTP vs. CCN-TV. \textit{Borda:} suporte apenas nos roteadores conectados na borda da rede. \textit{Total:} suporte em todos os roteadores da rede.
  \end{spacing}  
  \label{tb:fatores}
\end{table}

\subsubsection{Variáveis dependentes:}

As principais métricas para medir um sistema de distribuição de mídias ao vivo podem ser organizadas em três categorias~\cite{5343509,4395124}, apresentadas a seguir. 

\begin{enumerate}

  \item \textit{Qualidade de serviço à aplicação:} avaliam-se o atraso para iniciar a reprodução da mídia após um cliente requisitá-la ao servidor (ST); o índice de continuidade (IC); e a distorção do conteúdo em comparação ao original (DI). Como ilustra-se na Figura~\ref{fig:medicao-qualidade-midia}, a variável ST é o tempo transcorrido entre um nó cliente requisitar a mídia, receber os primeiros pacotes de dados até ser capaz de produzi-los. O valor da variável IC corresponde à razão entre o número de pacotes de dados da mídia entregues ao nó cliente antes do momento de reproduzi-los e o número total de pacotes de dados transmitidos. Por fim, o valor da variável DI corresponde à razão entre o número de quadros com erros e o número total de quadros disponíveis para serem entregues em um certo período. Para efeito de cálculo das variáveis IC e DI, considerou-se apenas o período em que cada nó cliente permaneceu conectado à rede. Por exemplo (Figura~\ref{fig:medicao-qualidade-midia}), se um nó cliente $1$ se conectou no instante \ut{14}{s}, começou a receber os pacotes de dados reproduzíveis no instante \ut{19}{s} (ST=4) e foi desconectado no instante \ut{49}{s}, considerou-se apenas os pacotes de dados entre os instantes \ut{19}{s} e \ut{48}{s} para calcular os valores de CI e DI do nó cliente $1$. Note que podem ocorrer quadros de vídeo com erro por dois motivos:

  \begin{enumerate}

    \item \textit{Atraso de chegada:} o nó recebeu o quadro corretamente, porém não foi possível reproduzi-lo por ter expirado (quadro recebido após o instante de sua correta reprodução);

    \item \textit{Devido às perdas de dependência:} o nó recebeu o quadro corretamente, porém não foi possível decodificá-lo devido à dependência de outro quadro indisponível.

  \end{enumerate}
 

  \begin{figure}[b!ht]
  \begin{center}
  \includegraphics[scale=.75]{imgs/medicao-qualidade-midia.pdf}
  \end{center}
  \vspace{-0.8cm}
  \caption{Exemplo de cálculo das variáveis dependentes ST, IC. Nesse caso, o valores ST = \ut{4}{s} e IC = \ut{70}{\%}.}
  \label{fig:medicao-qualidade-midia}
  \end{figure}

  \item \textit{Escalabilidade do sistema:} avalia-se a quantidade de nós simultâneos que foram capazes de receber o fluxo de dados da mídia transmitida com um nível de distorção máximo (ES). Nesse caso, mediu-se também o nível de contribuição das redes CDN e P2P, que corresponde à quantidade de fluxos transmitidos pelos servidores (QS) da CDN e pelos nós da rede P2P entre si (QP).

  \item \textit{Sobrecarga de controle:} avalia-se a quantidade de pacotes de controle (PC) transmitidos por um protocolo durante o tempo de simulação (contagem dos pacotes que não transportam dados da mídia), considerando-se $0,5$ cada pacote de \textit{piggyback}. 

\end{enumerate}

Com base nessas métricas, determinou-se as variáveis dependentes, apresentadas na Tabela~\ref{tb:variaveis-dependentes}.

\begin{table}[b!ht]
  \centering
  \caption{Tabela das variáveis dependentes (respostas) consideradas no experimento.}
  \renewcommand{\arraystretch}{1}% Spread rows out...
  \begin{tabular}{>{}m{4.1in} >{}m{1.0in}}
    \toprule
    \textbf{Variáveis dependentes} & \textbf{Símbolo} \\
    \midrule
    Atraso de inicialização do fluxo & ST \\
    Índice de continuidade (\%) & IC \\
    Distorção do vídeo (\%) & DI \\
%     Número de clientes com recepção acima de X\%$^1$ da mídia & ES \\
    Número de conexões ao servidor & QS \\
    Número de conexões entre clientes & QP \\
    Número de pacotes de controle & PC \\
    \bottomrule
  \end{tabular}
%   \scriptsize\raggedright
%   \begin{spacing}{0.5}
%     $^1$ As faixas dos valores de X são 0--20\%, 21--40\%, 41--60\%, 61--80\%, 91--100\%.\\
%   \end{spacing}
  \label{tb:variaveis-dependentes}
\end{table}


% Métricas:
%    - Atraso de inicialização do fluxo
%    - Índice de Continuidade / Quantidade de interrupções / tempo de recuperação (?)
%    - Distorção do conteúdo recebido em comparação ao transmitido
%    - Sobrecarga de controle
%    - Número de conexões no servidor / entre nós
%    - Número de nós clientes que receberam 90%, 80% e 70% da mídia do total de nós na rede
%    - Qualidade das parcerias, determinada pela taxa de transmissão entre o nó que compartilha e o nó que recebe: verifica se tinha um canal melhor (maior capacidade de transmissão se comparado ao canal utilizado) entre o nó provedor e o nó receptor.

% \subsection{Definição dos parâmetros do GMTP}
% 
% Olhar o capítulo 4 da tese da nandita para ver os valores dos parâmetros que ela usou
% ver a página 99 para discussões sobre os valores de alfa e beta
% 
% \begin{table}[b!ht]
%   \centering
%   \caption{Tabela dos parâmetros específicos do GMTP.}
%   \renewcommand{\arraystretch}{1}% Spread rows out...
%   \begin{tabular}{>{}m{2in} >{}m{2in}}
%     \toprule
%     \textbf{Parâmetros} & \textbf{Valores} \\
%     \midrule
%      &  \\
%      &  \\
%      &  \\
%     \bottomrule
%   \end{tabular}
%   \label{tb:gmpt-params}
% \end{table}

% % \subsubsection{Parâmetros dos sistemas estudados:}
% % 
% % Denacast/CoolStreaming
% % 
% % GMTP
% % 
% % CCN-TV


\subsection{População e amostras}

Constituiu-se a população por dados coletados durante a execução dos ensaios de acordo com às variáveis dependentes apresentadas na Tabela~\ref{tb:variaveis-dependentes}, com amostras coletadas a cada segundos. Como a duração de cada ensaio foi de \ut{900}{s}, coletou-se \ut{900}{} amostras e o valor final de cada variável dependente em cada ensaio foi determinado pela média aritmética das respectivas amostras.

% % \subsection{\textit{Design} de experimentos}
% 
% Como em uma rede de computadores erros frequentemente ocorrem nas transmissões, se fez necessário \textit{um design} de experimento com replicação. Assim o projeto de experimento escolhido obedece ao \textit{design} $2^k*r$, onde $k=3$ (três níveis) e $r=30$ (trinta replicações por tratamento).

\subsection{Tratamentos}
\label{subsec:tratamento}

Na Tabela~\ref{tb:tratamentos}, apresentam-se os tratamentos considerados no experimento, definidos com base na combinação dos fatores apresentados na Tabela~\ref{tb:fatores}. Definiu-se como  as unidades experimentais o GMTP, o Denacast/CoolStreaming e o CCN-TV, comparados em confrontos dois-a-dois, fixando-se o GMTP, em execuções não simultâneas. Nesse contexto, executaram-se $3792$ ensaios distribuídos em $18$ tratamentos, $1264$ ensaios para cada sistema estudado. Na coluna $n_t$, apresenta-se a quantidade de repetições de cada tratamento.

\begin{table}[b!ht]
  \centering
  \caption{Tabela dos tratamentos executados no experimento.}
  \renewcommand{\arraystretch}{1}% Spread rows out...
  \begin{tabular}{cccc}
    \toprule
    \textbf{Tratamento \#} & \textbf{Número de nós servidores (conectado(s) a)} & \textbf{Número de nós clientes} & $\boldsymbol{n_t}$\\
    \midrule
    1  & \multirow{6}{*} {1 (DE)} & 500 & 58 \\
    2  &  & 1.500 & 61 \\
    3  &  & 15.000 & 56 \\
    4  &  & 30.000 & 51 \\
    5  &  & 60.000 & 84 \\
    6  &  & 80.000 & 51 \\ \hline
    7  & \multirow{6}{*} {3 (DE, EE, PT)} & 500 & 87 \\
    8  &  & 1.500 & 79 \\
    9  &  & 15.000 & 73 \\
    10 &  & 30.000 & 88 \\
    11 &  & 60.000 & 95 \\
    12 &  & 80.000 & 86 \\  \hline
    13 & \multirow{6}{*} {5 (DE, EE, PT, NL, HU)} & 500 & 77 \\
    14 &  & 1.500 & 94 \\
    15 &  & 15.000 & 53 \\
    16 &  & 30.000 & 56 \\
    17 &  & 60.000 & 62 \\
    18 &  & 80.000 & 53 \\
    \bottomrule
  \end{tabular}
  \label{tb:tratamentos}
\end{table}

Com relação a execução de cada tratamento, executaram-se $50$ ensaios iniciais de cada sistema estudado, obtendo-se assim $50$ amostras para cada variável dependente. Em seguida, calculou-se a média dessas amostras e, para realizar comparações com \ut{95}{\%} de certeza, calculou-se a quantidade total de ensaios ($n_t$) de cada tratamento a fim de atingir este nível de confiança. Para isto, calculou-se a quantidade de ensaios necessários para obter \ut{95}{\%} de nível de confiança com base em duas médias (das amostras iniciais) $\mu_1,\mu_2$ de cada variável dependente, fixando-se $\mu_1$ como a média das variáveis dependentes do GMTP e $\mu_2$ a média ou do Denacast/CoolStreaming ou do CCN-TV. Sendo assim, a quantidade total de ensaios de cada tratamento foi determinado por $n_t = max(n_{ST}, n_{IC}, n_{DI}, n_{QS}, n_{QP}, n_{PC}) + 1$, onde os valores $n_{ST}, n_{IC}, n_{DI}, n_{QS}, n_{QP}, n_{PC}$ foram obtidos através da inequação de proporcionalidade para comparar duas alternativas~\cite{jain1991}. Por exemplo, se para o confronto GMTP vs. Denacast/CoolStreaming obteve-se $n_t = max(52, 67, 57, 85, \textbf{93}, 64) + 1$ e no confronto GMTP vs. CCN-TV obteve-se $n_t = max(55, 71, 75, 58, 59, 56) + 1$, considerou-se $n_t = 94$. Ou seja, repetiu-se $94$ vezes o mesmo tratamento para todos os sistemas estudados. No Apendência~\ref{app:detalhes-experimentos}, Seção~\ref{sec:ineq-proporcional}, apresentam-se mais detalhes sobre o cálculo de $n_t$.

Por fim, antes da execução de todos os ensaios de cada tratamento, executaram-se outras ações importantes:

\begin{enumerate}

  \item Configurou-se todos os nós clientes para enviar a requisição da mídia a um servidor escolhido especifico, escolhido aleatoriamente (distribuição uniforme). Sendo assim, garantiu-se que todos os sistemas avaliados fossem submetidos às mesmas quantidades de requisições ao(s) nó(s) servidor(es).

  \item Definiu-se a taxa de \textit{upload} de cada nó cliente com base em uma escolha aleatória entre as seguintes opções: \ut{512}{Kbps}, \ut{1}{Mbps}, \ut{2}{Mbps} (distribuição uniforme). Dessa forma, assegurou-se que os nós clientes foram submetidos as mesmas capacidades de transmissão, independente do sistema avaliado. 
%   Para essa estrutura de dados deu-se o nome de \textit{mapa de distribuição de taxas de upload}.

  \item Todos os nós clientes requisitaram a mídia nos primeiros \ut{200}{s}. Para definir o instante de cada requisição do cliente definiu-se o seguinte: gerou-se uma quantidade de números inteiros entre $0-200$ igual à quantidade de nós clientes determinado para um certo tratamento. Por exemplo, no Tratamento $1$ foram sorteados $500$ números inteiros aleatórios entre $0-200$ e somou-se o número de ocorrências de cada número sorteado. Durante a execução dos ensaios, adicionou-se à rede a quantidade de nós correspondente ao número de ocorrências em cada instante da simulação. Por exemplo, se o número $199$ foi sorteado $10$ vezes, no instante $199$ da simulação foram adicionados $10$ nós clientes que imediatamente requisitaram a mídia ao servidor.  Dessa forma, garantiu-se que os sistemas foram submetidos às mesmas condições iniciais de conexão entre os nós clientes e os nós servidores.
% Para essa distribuição deu-se o nome de mapa de conexão.

  \item A função de \textit{churn} foi acionada no instante \ut{400}{s}. A estratégia foi a seguinte: a cada intervalo de \ut{5}{s}, um número \textit{x} $\in$ $[0,1]$ foi gerado. Dependendo do valor de \textit{x}, \ut{10}{\%} dos nós clientes foram mantidos ou removidos com uma probabilidade de $0.7$. Ou seja, os nós foram mantidos conectados à rede com uma probabilidade de \ut{70}{\%} e removidos com uma probabilidade de \ut{30}{\%}. Com isto, garantiu-se que todas os sistemas avaliados fossem submetidos às mesmas condições de dinâmica da rede.

\end{enumerate}


\subsection{Instrumentação}

Com relação à instrumentação, utilizou-se OMNet++~\cite{XU2011,omnetpp2014}, um arcabouço para construção de simuladores de rede. Nesse contexto, utilizaram-se dois simuladores: o OverSim~\cite{oversim2014} e o CCN-Sim~\cite{ccnsim2014}. No OverSim, utilizaram-se as implementações do sistema Denacast/CoolStreaming~\cite{denacast2014} e a do GMTP~\cite{gmtp2014} (implementado no contexto deste trabalho), ao passo que no CCN-Sim, utilizou-se a implementação do CCN-TV~\cite{ccntv2014}.

\subsection{Formato da mídia}
\label{subsec:tipomidia}

Na Tabela~\ref{tb:midia-props}, apresentam-se as propriedades da mídia utilizada no experimento~\cite{967596} e na Figura~\ref{fig:starwars-bitrate} ilustra-se um gráfico da taxa de bits variáveis dos primeiros \ut{200}{s} da referida mídia.

% http://www-tkn.ee.tu-berlin.de/research/trace/ltvt.html

\begin{table}[b!ht]
  \centering
  \caption{Tabela das propriedades da mídia transmitida.}
  \renewcommand{\arraystretch}{1}% Spread rows out...
  \begin{tabular}{>{}m{2in} >{}m{2in}}
    \toprule
    \textbf{Propriedades} & \textbf{Valores} \\
    \midrule
    Mídia sintetizada & \textit{Star Wars IV} \\
    \textit{Codec} do vídeo & MPEG4 Part I \\
    Número de quadros & \ut{25}{fps} \\
    Número de quadros em GoP & 12 \\
    Média VBR & \ut{512}{Kbps} \\
    \bottomrule
  \end{tabular}
  \label{tb:midia-props}
\end{table}

\begin{figure}[b!ht]
\begin{center}
\includegraphics[natwidth=1737,natheight=724,scale=.21]{imgs/starwars-bitrate.png}
\end{center}
\vspace{-0.8cm}
\caption{Taxa de bits variáveis dos primeiros \ut{200}{s} da mídia utilizada no experimento (\textit{Star Wars IV}).}
\label{fig:starwars-bitrate}
\end{figure}

Com base na metodologia apresentada nesta seção, coletaram-se as amostras para as variáveis dependentes e realizou-se uma análise dos dados a fim de provar a hipótese enunciada na Seção~\ref{subsec:objetivo-hipotese}.

\section{Resultados e Discussões}
\label{sec:resdisc}

Nesta seção, apresentam-se os resultados e discussões dos confrontos GMTP vs. Denacast/CoolStreaming e GMTP vs. CCN-TV. Apresentam-se os resultados de acordo as categorias das métricas apresentadas na Seção~\ref{subsec:variaveis}: qualidade de serviço à aplicação, escalabilidade do sistema e sobrecarga de controle.

% A metodologia apresentada assegura uma análise dos resultados obtidos e discussões comparativas/conclusivas sobre o desempenho do GMTP em relação aos dois sistemas oponentes considerados, mas não garante estatisticamente comparações e portanto conclusões entre o Denacast/CoolStreaming e o CCN-TV.


\subsection{Qualidade de serviço à aplicação}

Nessa categoria, estudou-se o comportamento dos sistemas com vistas à três métricas: atraso de inicialização, índice de continuidade e nível de distorção da mídia recebida por cada nó cliente. A seguir, analise-se essas métricas a respeito dos sistemas estudados.

\subsubsection{Atraso de inicialização:}

Na Figura~\ref{fig:tratamentos-startup_time}, ilustra-se o gráfico da métrica \textit{Atraso de Inicialização (s)} para cada tratamento definido na Seção~\ref{subsec:tratamento}, observando-se a evolução dos sistemas Denacast/CoolStreaming, CCN-TV e GMTP. Nesse contexto, observa-se um desempenho satisfatório do GMTP frente aos outros sistemas estudados, com uma ressalva. Houve empate técnico entre os três sistemas nos tratamentos com $500$ nós clientes, constatando-se a mesma situação entre o Denacast/CoolStreaming e CCN-TV no tratamento $14$, quando se considerou $5$ nós servidores e $1.500$ nós clientes.

CORRIGIR O TEMPO DO DENACAST, TENTAR VER SE DÁ PRA CAPTURAR ALGUMA COISA DO PAPER DO CCN-TV

\begin{figure}[b!ht]
\begin{center}
\includegraphics[scale=.8]{imgs/results/tratamentos-startup_time}
\end{center}
\vspace{-0.8cm}
\caption{Resultado dos tratamentos (1 -- 18) para a métrica \textit{Atraso de Inicialização}.}
\label{fig:tratamentos-startup_time}
\end{figure}

No caso do GMTP, observa-se uma tendência de linearidade com relação ao atraso de inicialização em todos os experimentos, com aumentos suaves à medida em que se aumentou o número de nós clientes nos tratamentos com apenas $1$ nó cliente (tratamentos $1-6$). Na evolução do CCN-TV, observou-se um desempenho melhor se comparado ao Denacast/CoolStreaming, ao passo que se observou um empate técnico entre o GMTP e o CCN-TV no tratamento $2$. Observa-se que a linha de evolução do Denacast/CoolStreaming tem uma tendência de aumento, apesar de uma leve melhora quando se aumentou de $15.000$ para $30.000$ e o número de nós servidores. Esta melhora se explica pelo aumento significativo (o dobrou) do número de nós disponíveis, aumentando-se as chances da formação de boas parcerias. Porém, aumentando-se dobrando-se novamente o número de nós clientes (de $30.000$ para $60.000$) não se observa melhorias no atraso de inicialização. Isto indica limitação de escala, pois aumenta-se a quantidade de tráfego de dados e de controle devido ao aumento do número de fluxos de dados, aumentando-se as filas de roteamento e consequentemente o atraso de processamento dos pacotes de dados.

No caso da linha do CCN-TV, observa-se uma tendência de redução, à medida em que se aumenta o número de nós servidores e o número de nós clientes. Este comportamento é mais esperado em uma solução para distribuição de mídias em larga escala. Isto ocorre devido ao aumento do número de nós clientes requisitando a mesma mídia, aumentando-se as chances de outros nós clientes obterem as partes da mídia a partir de um \textit{cache} de roteador e não diretamente do servidor. Esse é o mesmo caso do GMTP, mas observa-se uma menor variação do atraso de inicialização porque se transmite toda requisição ao nó servidor, então se garante a obtenção dos primeiros pacotes de dados mais rapidamente, ao custo de os primeiros nós clientes sofrerem um maior atraso de inicialização. No caso do CCN-TV, como discutido na Seção~\ref{subsec:ndn}, utiliza-se uma tabela de repasse chamada de FIB, onde os conteúdos são catalogados pelo seu nome. Nas redes ICN, classificação mais ampla para as redes CCN/NDN, aboliu-se o conceito de comunicação fim-a-fim, sequer utiliza-se o esquema de endereçamento IP. Isto pode gerar um conflito sobre até quando um pacote de interesse circulará na rede até encontrar um roteador que possua o pacote de dados correspondente~\cite{6691438}. No caso do GMTP, uma requisição de um nó cliente para obter um fluxo de dados ao vivo continua sendo transmitida em direção ao servidor de origem, como atualmente ocorre na Internet. Se nenhum roteador interceptar o pedido, todos os passos tradicionais de uma conexão fim-a-fim ocorrem. A diferença é que se qualquer roteador presente na rota entre o nó cliente e o nó servidor já estiver repassando o pacote de dados por aquele caminho ou por outra \textit{interface}, este roteador interceptará a requisição do cliente e responderá a este como se fosse o nó servidor original, o que evita duplicação de fluxo de dados e reduz o atraso de inicialização.



Índice de continuidade x Tratamento

Distorção da mídia x Tratamento

% ATRASO DE INICIALIZAÇÃO

* depois de mudar as médias, validar os intervalos de confiança na hora que for fazer o algoritmo para gerar as linhas da tabela do latex 

- O GMTP teve o menor atraso de inicialização se comparado aos sistemas CoolStreaming e Denacast

- A estratégia de realizar cache nos roteadores apresenta um ganho significativo se comparado com soluções baseadas apenas nos sistemas finais, como é o caso do CoolStreaming

- No caso do CoolStreaming, observa-se que o atraso de inicialização está relacionado com a quantidade de nós servidores e de nós clientes. Ou seja, quanto mais nós clientes interessados na mídia, tende-se a um aumento significativo do atraso de inicialização. Apesar disso, observa-se uma suave redução do tempo de inicialização à medida que se adicionam mais nós servidores. Já no caso do GMTP e do CCN-TV, observa-se que não há um impacto negativo no desempenho de ambos, no ponto de vista do atraso de inicialização, com uma ligeira vantagens do GMTP à medida que a disponibilidade de nós servidores aumenta e cresce a quantidade de nós interessados pela mídia.




- Sobre o índice de continuidade dizer que se confirmou o que foi dito em~\cite{4509752} (Tratamento 5 e 6): O conceito de sub-fluxo adiciona complexidade à solução sem necessariamente resultado em melhor desempenho. Em~\cite{4509752}, os autores do CoolStreaming discutem que aumentar a quantidade de número de sub-fluxos não melhora proporcionalmente algumas métricas, como o índice de continuidade e
utilização da capacidade de \textit{upload} dos nós transmissores (em média). Os autores executaram simulações com 40 mil nós e 24 servidores auxiliares (que
funcionaram apenas como nós transmissores) e observaram que a partir de 8
sub-fluxos, as duas métricas citadas anteriormente não evoluem positivamente, piorando em alguns casos (quando se utiliza nós com capacidade heterogêneas de transmissão). CoolStreaming reduz o índice de continuidade devido ao churn

Um nó recém integrado à rede DONet pode levar muito tempo (em alguns
casos 20 segundos) para obter os primeiros blocos de vídeo e assim iniciar a
reprodução do conteúdo ao usuário final. Isto porque, ao se juntar à rede, um
nó solicita o mapa de \textit{buffer} a um conjunto de nós parceiros informados
por um servidor de \textit{boostrap}. Porém, o desafio é definir a partir de
qual ponto do \textit{buffer} um nó deve começar a solicitar os blocos de
vídeo. Por exemplo, se o novo nó requisitar um bloco de vídeo muito antigo, pode ser que tal bloco de vídeo não esteja mais disponível, já que o nó cliente o remove após sua reprodução. Por outro lado, se o nó requisitar um bloco de vídeo muito recente, pode ser que nenhum de seus nós parceiros tenha disponível. No GMTP, situações como essas não ocorrem porque se utiliza, por padrão o método \textit{push}, além do mais, as últimas partes da mídia já podem estar disponíveis no roteador, quando há outros clientes anteriores recebendo o fluxo de dados correspondente.

- O CoolStreaming leva em consideração apenas o nó que detém um determinado conteúdo de interesse e sua capacidade de upload. A estratégia de escolha aleatória de nós parceiros é limitante a uma certa quantidade de nós cliente, após isso observa-se muitas requisições aos nós servidores.

LER ISSO E VER O QUE APROVEITAR No caso do CoolStreaming há uma redução no atraso de inicialização apenas quando se aumenta o número de nós servidores, ao passo que para o GMTP e para o CCN-TV a quantidade de nós servidores não fez muita diferença. Apesar disso, observa-se que o GMTP teve um desempenho ligeiramente melhor e isto pode ser explicado pelo mecanismo de seleção de nós (Fase 3), que considera a capacidade de transmissão dos canais conhecidos para escalonar a fim de escalonar os melhores nós parceiros.

=====

Influência no atraso de inicialização: número de nós, que aumenta o tráfego de controle, mas observa-se que o à medida em que se aumenta o número de servidores, há uma tendência de queda no atraso de inicialização. O problema é o impacto disso no número de conexões ao servidor. O Denacast/CoolStreaming sofre mais por isso porque nesse sistema não se mantém controle sobre quando desconectar do servidor e sugerir ao nó que troque dados com outro. Uma vez conectado no servidor, o nó permanece conectado, podendo repassar a outros nós parceiros. No caso do GMTP, um nó servidor apenas aceita uma conexão caso não exista nenhum nó no caminho até o servidor já recebendo o fluxo de dados. Ou seja, o GMTP observa o estado de conexão através de uma rota de rede. Nas requisições subsequentes originadas através de pelo menos parte do caminho, o nó servidor é notificado sobre tal requisição, mas instruirá o roteador intermediário (aquele que já está recebendo o fluxo de dados) a repassar o conteúdo também para o novo nó.


% ÍNDICE DE CONTINUIDADE

\begin{figure}[b!ht]
\begin{center}
\includegraphics[scale=.8]{imgs/results/tratamentos-continuity_index}
\end{center}
\vspace{-0.8cm}
\caption{Resultado dos tratamentos (1 -- 18) para a métrica \textit{Índice de Continuidade}.}
\label{fig:tratamentos-continuity_index}
\end{figure}


% DISTORÇÃO

\begin{figure}[b!ht]
\begin{center}
\includegraphics[scale=.8]{imgs/results/tratamentos-distortion}
\end{center}
\vspace{-0.8cm}
\caption{Resultado dos tratamentos (1 -- 18) para a métrica \textit{Distorção}.}
\label{fig:tratamentos-distortion}
\end{figure}


% CONEXÃO COM O SERVIDOR

\begin{figure}[b!ht]
\begin{center}
\includegraphics[scale=.8]{imgs/results/tratamentos-server_connection}
\end{center}
\vspace{-0.8cm}
\caption{Resultado dos tratamentos (1 -- 18) para a métrica \textit{Número de Conexões ao Servidor}.}
\label{fig:tratamentos-server_connection}
\end{figure}


% CONEXÃO ENTRE CLIENTES

\begin{figure}[b!ht]
\begin{center}
\includegraphics[scale=.8]{imgs/results/tratamentos-clients_connection}
\end{center}
\vspace{-0.8cm}
\caption{Resultado dos tratamentos (1 -- 18) para a métrica \textit{Número de Conexões entre Clientes}.}
\label{fig:tratamentos-clients_connection}
\end{figure}


% PACOTES DE CONTROLE

\begin{figure}[b!ht]
\begin{center}
\includegraphics[scale=.8]{imgs/results/tratamentos-packet_control}
\end{center}
\vspace{-0.8cm}
\caption{Resultado dos tratamentos (1 -- 18) para a métrica \textit{Número de Pacotes de Controle}.}
\label{fig:tratamentos-packet_control}
\end{figure}

\subsection{Escalabilidade dos sistemas}

Conexões ao servidor x Conexões entre clientes

\subsection{Sobrecarga de controle}

Pacotes de Controle x Número de nós clientes

\subsection{Sumarização dos resultados}

Pensar num gráfico que relacione a média geométrica de todos as variáveis dependentes com os fatores. Em um contexto geral, comparando em um único número para cada protocolo, fazer um gráfico de barras, usar média geométrica, ou seja:

Dizer que o GMTP tem um melhor desempenho porque a seleção de nós considera a capacidade do canal

% * p17: na sua tese, o que seria um resultado que a negaria? Ela não pode ser óbvia.
%      - Um protocolo que comprovasse fazer melhor do que o GMTP considerando apenas a comunicação end-to-end, com suporte a controle de congestionamento (o que mais??)
%      - Seleção de nós é importante

COMENTAR O QUE NEGARIA A MINHA TESE, TANTO NO CONTEXTO DE UM SISTEMA (EX. DENACAST) QUANTO NO CONTEXTO DE INFRA (EX. CCN)



\section{Sumário do Capítulo}
\label{sec:resdisc-sumario}

A interoperabilidade é uma medição arquitetural, explicar isso. Como medir a quantidade de aplicações de distribuição de mídias ao vivo diferentes e a quantidade de eventos iguais sendo transmitidos


Sendo assim, o que resta para a aplicação? replicar conteudo nos servidores da cdn e estratégias para acessa-los (load balancing etc)










% \subsection{Considerações sobre Implementação}
% 
% Com o intuito de investigar o desempenho do GMTP, implementou-se no simulador de redes OMNet++~\cite{XU2011} suas principais funcionalidades. A versão  e sua versão atual do protocolo já permite a execução de transmissão de dados. Com o
% desenvolvimento preliminar do protocolo \mudccps no simulador NS-2, permitiu-se
% a execução de diversas simulações a fim de avaliar o comportamento do protocolo
% considerando diversas configurações.
% 
% Em linhas gerais, a implementação no referido simulador de rede permite a
% comunicação entre os nós através dos modos de transmissão multicast e unicast.
% Foram implementados os tipos de pacotes do \mudccps e os processos de
% estabelecimento de conexão, incluindo o processo de uso de nós relays, troca
% de dados em modos multicast e unicast e os algoritmos para controle de
% congestionamento, incluindo o uso de nós reporters.
% 
% Contudo, não foi implementado o arcabouço de extensão para permitir o
% desenvolvimento de novos algoritmos para o processo de conexão, descoberta e
% seleção de nós, adaptação de fluxo de dados e tolerância a falhas. Tal
% implementação será feita no núcleo do sistema operacional Linux, juntamente com
% todos os mecanismos básicos para o funcionamento do \mudccp.
% 
% A proposta é de implementar um arcabouço de extensão para as funções previstas
% no \mudccp, permitindo-se o desenvolvimento e adição de novos algoritmos para
% as funcionalidades supracitadas, de modo que torne o \mudccps flexível para
% permitir que qualquer aplicação os utilizem.
% 
% Na prática, um cenário desejado para essa proposta de implementação do \mudccps
% é que o desenvolvedor possa configurar quais algoritmos deseja utilizar em sua
% aplicação, permitindo-se que estes sejam alterados em modo de execução da
% da mesma. Neste caso, suponha um algoritmo de descoberta de nós chamado
% \textit{DN-1}, um algoritmo para controle de congestionamento chamado
% \textit{CC-2}, um algoritmo de tolerância a desconexão \textit{TD-3}; um
% algoritmo de adaptação de fluxo \textit{AF-4} e um algoritmo para reciprocidade
% % \textit{R-2}. As implementações de tais algoritmos serão feitas na camada de
% transporte, acoplando-as em forma de módulos do sistema operacional ao protocolo
% \mudccp. Em seguida, as aplicações podem selecionar quais algoritmos melhor se
% adequa as suas necessidades, com o \mudccps sendo responsável por:
% 
% \begin{enumerate}
% 
%   \item carregar o conjunto de algoritmos \textit{A = \{DN-1, CC-2, TD-3, AF-4,
% R-2\}};
% 
%   \item definir os parâmetros iniciais para cada um dos algoritmos em A,
% definidos pela aplicação;
% 
%   \item executar funções preliminares para ajustes iniciais, tais como informar
% aos nós participantes de uma transmissão quais dos algoritmos estão sendo
% utilizados (o conjunto \textit{A}) e quais outros estão disponíveis;
% 
%   \item executar os algoritmos em momentos apropriados de acordo com os eventos
% de rede, notificando a aplicação caso necessário e desejável pela aplicação;
% 
%   \item descarregar os algoritmos quando não forem mais necessários e informar
% aos nós parceiros.
% 
% \end{enumerate}
% 
% Desta forma, um nó servidor poderá solicitar que seus nós clientes carreguem um
% determinado módulo, dependendo da sua disponibilidade nos nós clientes. Neste
% caso, o \mudccps controlará todo o processo de carregamento dos mesmos.
% 
% Com isso, o \mudccps se tornará um protocolo extensível que gerencia quais
% algoritmos devem ser executados em cada ponto de extensão. Esses algoritmos
% podem ser adicionados ao protocolo através de módulos do sistema operacional,
% carregáveis utilizando-se comandos como o \textit{modprobe} (no Linux, por
% exemplo) e manipulados (passagem de parâmetros) pela aplicação através de uma
% API de programação, por exemplo, utilizando-se as primitivas
% \textit{setsockopt()} e \textit{getsockopt()} da especificação \textit{BSD
% Socket API}~\cite{1197551}.
% 
% Para que as aplicações possam utilizar o \mudccp, o protocolo deve ser
% compatível com todas as funções prevista na especificação \textit{BSD Socket
% API}, são elas: \textit{socket()}, \textit{bind()}, \textit{listen()},
% \textit{connect()}, \textit{accept()}, \textit{send()}, \textit{recv()},
% \textit{write()}, \textit{read()}, \textit{sendto()}, \textit{recvfrom()},
% \textit{close()}, \textit{select()}, \textit{setsockopt()},
% \textit{getsockopt()} e \textit{pull()}.
% 
% Outros trabalhos podem ser desenvolvidos para tornar o \mudccps compatível com o
% padrão de \textit{sockets} do sistema operacional Windows, conhecido pelo nome
% de \textit{winsock}. Todavia, por ser um sistema operacional de código fechado,
% a implementação do \mudccps só será possível após sua padronização em forma de
% RFC.