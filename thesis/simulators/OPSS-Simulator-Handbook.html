<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
<meta name="description" content="OPSS - Large scale peer to peer streaming simulator" />
<meta name="keywords" content="" />
<link rel="stylesheet" type="text/css" href="http://opss.sourceforge.net/wp-content/themes/1024px/style.css" />
<link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="http://opss.sourceforge.net/feed/" />
<link rel="alternate" type="text/xml" title="RSS .92" href="http://opss.sourceforge.net/feed/rss/" />
<link rel="alternate" type="application/atom+xml" title="Atom 0.3" href="http://opss.sourceforge.net/feed/atom/" />
<link rel="pingback" href="http://opss.sourceforge.net/xmlrpc.php" />
<title>OPSS &raquo; Simulator Handbook</title>
<link rel="alternate" type="application/rss+xml" title="OPSS &raquo; Simulator Handbook Comments Feed" href="http://opss.sourceforge.net/documentation/simulator-handbook/feed/" />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://opss.sourceforge.net/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://opss.sourceforge.net/wp-includes/wlwmanifest.xml" /> 
<link rel='index' title='OPSS' href='http://opss.sourceforge.net' />
<link rel='up' title='Documentation' href='http://opss.sourceforge.net/documentation/' />
<meta name="generator" content="WordPress 2.8.6" />
</head>

<body>
<div id="wrap">

<!--div id="header">
<h1><a href="http://opss.sourceforge.net">OPSS</a></h1>
<p id="slogan">Large scale peer to peer streaming simulator</p>
</div -->

<div id="header">
 <div id="headerimg">
  <div id="maintitle">
   <h1><a href="http://opss.sourceforge.net">OPSS</a></h1>
<p id="slogan">Large scale peer to peer streaming simulator</p>
    </div>
  </div>
</div>
<div id="content">

<h2>Simulator Handbook</h2>
<div class="contenttext">
<p><em>This documentation must be updated</em></p>
<div><span style="font-family: 'Lucida Grande', verdana, arial, sans-serif; font-size: medium;"><span style="line-height: normal; white-space: pre-wrap;"></p>
<h4 style="line-height: 17px; padding-top: 0.1em; padding-right: 5px; padding-bottom: 0.1em; padding-left: 5px; margin-top: 1em; margin-right: -5px; margin-bottom: 0.35em; margin-left: -5px; font-weight: normal; font-size: 17px; display: block; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 1px; border-left-width: 0px; height: auto; background-color: transparent; color: #333399; border-color: #e9e4d2; border-style: solid;">Intro</h4>
<p>This is a discrete event driven simulator developed for <span style="border-top-width: 0px; border-right-width: 0px; border-bottom-width: 1px; border-left-width: 0px; border-color: #dddddd; border-style: solid;">P2P</span> Streaming purpose but can be easly ported also for other <span style="border-top-width: 0px; border-right-width: 0px; border-bottom-width: 1px; border-left-width: 0px; border-color: #dddddd; border-style: solid;">P2P</span> Service. This simulator aims to replicate the network status during a <span style="border-top-width: 0px; border-right-width: 0px; border-bottom-width: 1px; border-left-width: 0px; border-color: #dddddd; border-style: solid;">P2P</span> streaming session of a large amount of users ( we hope &gt; 10^5) for performance evaluation of the different kind of algorithm that exist in letterature or in common <span style="border-top-width: 0px; border-right-width: 0px; border-bottom-width: 1px; border-left-width: 0px; border-color: #dddddd; border-style: solid;">P2P</span> streaming application (<span style="border-top-width: 0px; border-right-width: 0px; border-bottom-width: 1px; border-left-width: 0px; border-color: #dddddd; border-style: solid;">CoolStreaming</span> , PPLive, Gridmedia &#8230;)</p>
<p style="margin-top: 1em; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; background-color: transparent;">
<h4 style="line-height: 17px; padding-top: 0.1em; padding-right: 5px; padding-bottom: 0.1em; padding-left: 5px; margin-top: 1em; margin-right: -5px; margin-bottom: 0.35em; margin-left: -5px; font-weight: normal; font-size: 17px; display: block; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 1px; border-left-width: 0px; height: auto; background-color: transparent; color: #333399; border-color: #e9e4d2; border-style: solid;"><a name="Architecture"></a>Architecture</h4>
<p>The architecture is composed of 3 layer:</p>
<ul style="margin-top: 0px; background-color: transparent;">
<li style="background-color: transparent; line-height: 1.4em;"><strong>User</strong> : it represents user behaviour (the time he connects and when he disconnects from the network)</li>
<li style="background-color: transparent; line-height: 1.4em;"><strong>Overlay</strong> : it represents <span style="border-top-width: 0px; border-right-width: 0px; border-bottom-width: 1px; border-left-width: 0px; border-color: #dddddd; border-style: solid;">P2P<a style="text-decoration: none; color: #0066cc; background-color: transparent; margin-left: 1px;" title="Create this topic" rel="nofollow" href="http://netgroup.uniroma2.it/twiki/bin/edit.cgi/Netgroup/P2P?topicparent=Netgroup.SimulatorGuide">?</a></span> program behaviour (algorithm &#8230;)</li>
<li style="background-color: transparent; line-height: 1.4em;"><strong>Network</strong> : it represents the net behaviour, with an optimized MMF approach (so for this moment we consider only TCP for chunck transmission).</li>
</ul>
<p style="margin-top: 1em; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; background-color: transparent;">
<h4 style="line-height: 17px; padding-top: 0.1em; padding-right: 5px; padding-bottom: 0.1em; padding-left: 5px; margin-top: 1em; margin-right: -5px; margin-bottom: 0.35em; margin-left: -5px; font-weight: normal; font-size: 17px; display: block; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 1px; border-left-width: 0px; height: auto; background-color: transparent; color: #333399; border-color: #e9e4d2; border-style: solid;"><a name="Using_the_Simulator"></a>Using the Simulator</h4>
<p>The project is divided into 5 directory:</p>
<ul style="margin-top: 0px; background-color: transparent;">
<li style="background-color: transparent; line-height: 1.4em;"><strong>Engine</strong>: Contains the engine of the simulator, the Calendar, base events needed for the simulation and data structures for content distribution.</li>
<li style="background-color: transparent; line-height: 1.4em;"><strong>Network</strong> Contains the data structures for abstract network behaviour (methods for establish or destroy connections) and the algorithm for Max Min Fair bandwidth allocation</li>
<li style="background-color: transparent; line-height: 1.4em;"><strong>Overlay</strong> Contains the basic functions that every Node must do in every algorithm</li>
<li style="background-color: transparent; line-height: 1.4em;"><strong>User</strong> Contains some basic functions of the User layer that can be overloaded from user</li>
<li style="background-color: transparent; line-height: 1.4em;"><strong>Customize</strong> Contains all the classes that can change among different <span style="border-top-width: 0px; border-right-width: 0px; border-bottom-width: 1px; border-left-width: 0px; border-color: #dddddd; border-style: solid;">P2P<a style="text-decoration: none; color: #0066cc; background-color: transparent; margin-left: 1px;" title="Create this topic" rel="nofollow" href="http://netgroup.uniroma2.it/twiki/bin/edit.cgi/Netgroup/P2P?topicparent=Netgroup.SimulatorGuide">?</a></span> alorithm so for evaluating performances of different application, you only need to change the files into this directory</li>
</ul>
<p style="margin-top: 1em; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; background-color: transparent;">
<p style="margin-top: 1em; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; background-color: transparent;">There is also a simple grafical interface done with NCURSES lib. To compile the simulator you only need to run Makefile doing &#8220;make&#8221; or &#8220;make -f debug&#8221;. You need pthreads and optionally ncurses libreries installed on your machine. To run the simulator, simply do &#8220;./simulator&#8221; and it will start the simulation with the parameters and functions specified into the Customize directory.</p>
<p style="margin-top: 1em; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; background-color: transparent;">
<h4 style="line-height: 17px; padding-top: 0.1em; padding-right: 5px; padding-bottom: 0.1em; padding-left: 5px; margin-top: 1em; margin-right: -5px; margin-bottom: 0.35em; margin-left: -5px; font-weight: normal; font-size: 17px; display: block; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 1px; border-left-width: 0px; height: auto; background-color: transparent; color: #333399; border-color: #e9e4d2; border-style: solid;"><a name="Programming_the_Simulator"></a>Programming the Simulator</h4>
<p style="margin-top: 1em; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; background-color: transparent;">
<h6 style="line-height: 13px; padding-top: 0.1em; padding-right: 5px; padding-bottom: 0.1em; padding-left: 5px; margin-top: 1em; margin-right: -5px; margin-bottom: 0.35em; margin-left: -5px; font-weight: normal; font-size: 13px; display: block; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 1px; border-left-width: 0px; height: auto; background-color: transparent; color: #333399; border-color: #e9e4d2; border-style: solid;"><a name="Calendars_and_Events"></a>Calendars and Events</h6>
<p>As for the others discreet events simulator, the main component of its engine is a Calendar object that process other objects called Events according to the time they are associated. The routine for executing all events by the calendar is in main.cpp file and it&#8217;s a simple loop that run all the instructions associated to every Event in the calendar, delete the Event and go to the next Event untill Calendar reaches simulation_length.</p>
<p style="margin-top: 1em; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; background-color: transparent;">To put an event into the Calendar you must include the file &#8220;engine/Calendar.h&#8221; and do the static method:</p>
<pre style="width: auto; margin-top: 1em; margin-right: 0px; margin-bottom: 1em; margin-left: 0px; color: #3a0075; overflow-x: scroll; overflow-y: scroll;">Calendar::put(Event* e);</pre>
<p>To get the more recent event from Calendar you must do:</p>
<pre style="width: auto; margin-top: 1em; margin-right: 0px; margin-bottom: 1em; margin-left: 0px; color: #3a0075; overflow-x: scroll; overflow-y: scroll;">Event* e = Calendar::get();</pre>
<p>The calandar will go ahead and pass to the next Event. To view the current calendar time you can do:</p>
<pre style="width: auto; margin-top: 1em; margin-right: 0px; margin-bottom: 1em; margin-left: 0px; color: #3a0075; overflow-x: scroll; overflow-y: scroll;">Time t = Calendar::time;</pre>
<p style="margin-top: 1em; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; background-color: transparent;">Every Event must have a name, a time reference and a the set of instruction that must be executed in that time. In &#8220;engine/Event.h&#8221; you can find the prototype of the Event class that every event must be inheredit from all the other events. In &#8220;customize/Events.h&#8221; and &#8220;customize/Event.cpp&#8221; you can put your own events. In this example I write to the Trace file &#8220;Hello World!&#8221;.</p>
<p style="margin-top: 1em; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; background-color: transparent;"><em>customize/Events.h</em></p>
<pre style="width: auto; margin-top: 1em; margin-right: 0px; margin-bottom: 1em; margin-left: 0px; color: #3a0075; overflow-x: scroll; overflow-y: scroll;">#include "../engine/Event.h"
class TestEvent : public Event {
 public:
   TestEvent(Time time, char* name);
   void body() ;
};</pre>
<p style="margin-top: 1em; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; background-color: transparent;"><em>customize/Events.cpp</em></p>
<pre style="width: auto; margin-top: 1em; margin-right: 0px; margin-bottom: 1em; margin-left: 0px; color: #3a0075; overflow-x: scroll; overflow-y: scroll;">#include "Events.h"
#include "..engine/Tracer.h"
TestEvent::TestEvent(Time time, char* name) : Event(time, "TESTEVENT") {
   Tracer::write("Hello World!");
}</pre>
<p style="margin-top: 1em; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; background-color: transparent;">If you want to print the same string every 10 seconds, you use this trick: <em>customize/Events.cpp</em></p>
<pre style="width: auto; margin-top: 1em; margin-right: 0px; margin-bottom: 1em; margin-left: 0px; color: #3a0075; overflow-x: scroll; overflow-y: scroll;">#include "Events.h"
#include "..engine/Tracer.h"
TestEvent::TestEvent(Time time, char* name) : Event(time, "TESTEVENT") {
   Tracer::write("Hello World!");
   Calendar::put(new TestEvent(Calendar::time()+10, "TESTEVENT"))
}</pre>
<p style="margin-top: 1em; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; background-color: transparent;">In &#8220;engine/Event.h&#8221; there are also some predefined basic events such:</p>
<p style="margin-top: 1em; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; background-color: transparent;">
<ul style="margin-top: 0px; background-color: transparent;">
<li style="background-color: transparent; line-height: 1.4em;"><strong>EndDownload:</strong> It is called every time a node finish a download of a chunk</li>
<li style="background-color: transparent; line-height: 1.4em;"><strong>DisconnectNode:</strong> it programs the disconnection ad the distruction of a Node. This event is set</li>
<li style="background-color: transparent; line-height: 1.4em;"><strong>StartDownload:</strong> it programs the creation of a Node an its joining to the overlay network.</li>
<li style="background-color: transparent; line-height: 1.4em;"><strong>GenerateNodes:</strong> It is called every GENERATION_INTERARRIVAL_TIME and call User::generateNodes , a routine that generetes new nodes for growing the population until it reach a treshold NODE_NUMBER. It is a User mechanism and it will be explained better later.</li>
<li style="background-color: transparent; line-height: 1.4em;"><strong>PlayChunk:</strong> We expect that every node, after it connects to the overlay, start to download chunks from the network (Prebuffering). After he collects PREBUFFERING_THRESHOLD consecutive chunks, he start to play the stream. This operation is modelized as a <span style="border-top-width: 0px; border-right-width: 0px; border-bottom-width: 1px; border-left-width: 0px; border-color: #dddddd; border-style: solid;">PlayChunk<a style="text-decoration: none; color: #0066cc; background-color: transparent; margin-left: 1px;" title="Create this topic" rel="nofollow" href="http://netgroup.uniroma2.it/twiki/bin/edit.cgi/Netgroup/PlayChunk?topicparent=Netgroup.SimulatorGuide">?</a></span> events that every CHUNK_DURATION milliseconds check if the node has got a chunk. If he got it, next time it will be asked for chunk with successive chunkId, else <span style="border-top-width: 0px; border-right-width: 0px; border-bottom-width: 1px; border-left-width: 0px; border-color: #dddddd; border-style: solid;">LostStream<a style="text-decoration: none; color: #0066cc; background-color: transparent; margin-left: 1px;" title="Create this topic" rel="nofollow" href="http://netgroup.uniroma2.it/twiki/bin/edit.cgi/Netgroup/LostStream?topicparent=Netgroup.SimulatorGuide">?</a></span>function of the Node will be called and the node start <span style="border-top-width: 0px; border-right-width: 0px; border-bottom-width: 1px; border-left-width: 0px; border-color: #dddddd; border-style: solid;">PreBuffering<a style="text-decoration: none; color: #0066cc; background-color: transparent; margin-left: 1px;" title="Create this topic" rel="nofollow" href="http://netgroup.uniroma2.it/twiki/bin/edit.cgi/Netgroup/PreBuffering?topicparent=Netgroup.SimulatorGuide">?</a></span> .</li>
<li style="background-color: transparent; line-height: 1.4em;"><strong>StartDownload:</strong> It programs the starting of a chunk download.</li>
<li style="background-color: transparent; line-height: 1.4em;"><strong>CreateContent:</strong> It is called every CHUNK_DURATION milliseconds and add a <span style="border-top-width: 0px; border-right-width: 0px; border-bottom-width: 1px; border-left-width: 0px; border-color: #dddddd; border-style: solid;">ChunkInfo<a style="text-decoration: none; color: #0066cc; background-color: transparent; margin-left: 1px;" title="Create this topic" rel="nofollow" href="http://netgroup.uniroma2.it/twiki/bin/edit.cgi/Netgroup/ChunkInfo?topicparent=Netgroup.SimulatorGuide">?</a></span> object (explained after) into a static list called Content and included in overlay/Chunk.h .</li>
</ul>
<p style="margin-top: 1em; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; background-color: transparent;">You can define Events that overload these basic events, for example to implements an algorithm every time a Node download a chunk, you can define a class like this:</p>
<p style="margin-top: 1em; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; background-color: transparent;"><em>customize/Events.h</em></p>
<pre style="width: auto; margin-top: 1em; margin-right: 0px; margin-bottom: 1em; margin-left: 0px; color: #3a0075; overflow-x: scroll; overflow-y: scroll;">#include "../engine/Event.h"
class ExtendedEndDownload {
    public: body() {
    EndDownload::body();  // Calls the "old" EndDownload body
    /* Your Alogorithm here
     *
     *
     */
     }
};</pre>
<p style="margin-top: 1em; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; background-color: transparent;">
<p style="margin-top: 1em; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; background-color: transparent;">
<p style="margin-top: 1em; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; background-color: transparent;">
<h6 style="line-height: 13px; padding-top: 0.1em; padding-right: 5px; padding-bottom: 0.1em; padding-left: 5px; margin-top: 1em; margin-right: -5px; margin-bottom: 0.35em; margin-left: -5px; font-weight: normal; font-size: 13px; display: block; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 1px; border-left-width: 0px; height: auto; background-color: transparent; color: #333399; border-color: #e9e4d2; border-style: solid;"><a name="Output_and_TraceFile"></a>Output and <span style="border-top-width: 0px; border-right-width: 0px; border-bottom-width: 1px; border-left-width: 0px; border-color: #dddddd; border-style: solid;">TraceFile<a style="text-decoration: none; color: #0066cc; background-color: transparent; margin-left: 1px;" title="Create this topic" rel="nofollow" href="http://netgroup.uniroma2.it/twiki/bin/edit.cgi/Netgroup/TraceFile?topicparent=Netgroup.SimulatorGuide">?</a></span></h6>
<p style="margin-top: 1em; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; background-color: transparent;">As you see in previous example, if you want to write something in the tracelog, you must include &#8220;engine/Tracer.h&#8221; and write:</p>
<pre style="width: auto; margin-top: 1em; margin-right: 0px; margin-bottom: 1em; margin-left: 0px; color: #3a0075; overflow-x: scroll; overflow-y: scroll;">    Tracer::write("Test string");</pre>
<p>A writer thread try to write the string on a file. The &#8220;log level&#8221; is setted as default to USER_DEFINED. If the LOGLEVEL (explained after) permits USER_DEFINED Logs to be written, the strings will be written in the tracefile.</p>
<p style="margin-top: 1em; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; background-color: transparent;">The logging system allows flexible tracing, enabling/disabling logging for each category of events. These categories are listed in engine/Tracer.h. Special cateogries are also defined to allow skip tracing some events, or to trace events not included:</p>
<p style="margin-top: 1em; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; background-color: transparent;">passing NO_LOG to Tracer&#8217;s write function, i.e. calling Tracer::write(buf,NO_LOG), will not add buf to the log while the use of USER_DEFINED as a parameter will trace custom events. Tracer::write has USER_DEFINED has default parameter, so calling Tracer::write(buf) has the same effect of calling Tracer::write(buf,USER_DEFINED).</p>
<p style="margin-top: 1em; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; background-color: transparent;">customize/Globals.h contains the variable to be set in order to specify the events to be logged. The variable&#8217;s name is LOGLEVEL and must be set by summing the event&#8217;s categories (also listed in customize/Globals.h) to be logged. Be careful to include LOG_USER_DEFINED category if user defined as well as default events need to be traced.</p>
<p style="margin-top: 1em; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; background-color: transparent;">
<p style="margin-top: 1em; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; background-color: transparent;">Example:</p>
<p style="margin-top: 1em; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; background-color: transparent;">In order to trace &#8220;chunk creation&#8221; and &#8220;end download&#8221; events (as well as user defined events) LOGLEVEL must be set to &#8220;LOG_CHUNK_CREATION + LOG_END_DOWNLOAD &#8221; (see customize/Globals.h for log labels). New categories of events can also be defined. To do so add a new constant in engine/Tracer.h. Remember to add another constant in customize/Globals.h corresponding to 2^(new constant) in order to allow easy loglevel definition ( at the moment the Tracer can handle up to code 15). Once defined remember to pass the right constant when calling Tracer::write()</p>
<p style="margin-top: 1em; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; background-color: transparent;">
<p style="margin-top: 1em; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; background-color: transparent;">To set the name of the tracefile , the LOGLEVEL and other parameters, you must configure &#8220;customize/Globals.h&#8221; . The meaning of the parameters inside Globals.h file are explained inside the file.</p>
<p style="margin-top: 1em; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; background-color: transparent;">
<p style="margin-top: 1em; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; background-color: transparent;">
<h6 style="line-height: 13px; padding-top: 0.1em; padding-right: 5px; padding-bottom: 0.1em; padding-left: 5px; margin-top: 1em; margin-right: -5px; margin-bottom: 0.35em; margin-left: -5px; font-weight: normal; font-size: 13px; display: block; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 1px; border-left-width: 0px; height: auto; background-color: transparent; color: #333399; border-color: #e9e4d2; border-style: solid;"><a name="User_behaviour"></a>User behaviour</h6>
<p>According to the architecture of the simulator, In customize/User.h / cpp , there is the User class that represents the Users behaviour. This class have got two main methods</p>
<pre style="width: auto; margin-top: 1em; margin-right: 0px; margin-bottom: 1em; margin-left: 0px; color: #3a0075; overflow-x: scroll; overflow-y: scroll;">Time evaluateUptime()</pre>
<p>and</p>
<pre style="width: auto; margin-top: 1em; margin-right: 0px; margin-bottom: 1em; margin-left: 0px; color: #3a0075; overflow-x: scroll; overflow-y: scroll;">void generateNodes()</pre>
<p>. The former must give in its output the life duration of a node. This code, for example, make every node died one minute after their connection:</p>
<pre style="width: auto; margin-top: 1em; margin-right: 0px; margin-bottom: 1em; margin-left: 0px; color: #3a0075; overflow-x: scroll; overflow-y: scroll;">Time User::evaluateUptime() {
   return Time(60);
 }</pre>
<p>You can use some of the statistical functions included in the Statistic class written in engine/Statistic.h / cpp files. The lattest methods are called every GENERATION_INTERARRIVAL_TIME and it must re-populate the node died during the simulation. For example if you want to mantain 1000 node that live of only 100 seconds, you can set GENERATION_INTERARRIVAL_TIME = 10 in Globals.h and write in User::generateNodes() this algorithm:</p>
<pre style="width: auto; margin-top: 1em; margin-right: 0px; margin-bottom: 1em; margin-left: 0px; color: #3a0075; overflow-x: scroll; overflow-y: scroll;">void User::generateNodes(){
        int diff = NODE_NUMBER - BaseNode::mNodes.size();
   Node* node;
   for (int i = 1; i &lt;=diff; i++) {
      node = new Node(100, 100);
      Calendar::put(new DisconnectNode(node , Calendar::time() + evaluateUptime() ));
   }
}</pre>
<p style="margin-top: 1em; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; background-color: transparent;">There is no reason for create more that an User. When a user is created it starts the first <span style="border-top-width: 0px; border-right-width: 0px; border-bottom-width: 1px; border-left-width: 0px; border-color: #dddddd; border-style: solid;">CreateContent<a style="text-decoration: none; color: #0066cc; background-color: transparent; margin-left: 1px;" title="Create this topic" rel="nofollow" href="http://netgroup.uniroma2.it/twiki/bin/edit.cgi/Netgroup/CreateContent?topicparent=Netgroup.SimulatorGuide">?</a></span> and <span style="border-top-width: 0px; border-right-width: 0px; border-bottom-width: 1px; border-left-width: 0px; border-color: #dddddd; border-style: solid;">GenerateNodes<a style="text-decoration: none; color: #0066cc; background-color: transparent; margin-left: 1px;" title="Create this topic" rel="nofollow" href="http://netgroup.uniroma2.it/twiki/bin/edit.cgi/Netgroup/GenerateNodes?topicparent=Netgroup.SimulatorGuide">?</a></span> events.</p>
<p style="margin-top: 1em; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; background-color: transparent;">
<h6 style="line-height: 13px; padding-top: 0.1em; padding-right: 5px; padding-bottom: 0.1em; padding-left: 5px; margin-top: 1em; margin-right: -5px; margin-bottom: 0.35em; margin-left: -5px; font-weight: normal; font-size: 13px; display: block; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 1px; border-left-width: 0px; height: auto; background-color: transparent; color: #333399; border-color: #e9e4d2; border-style: solid;"><a name="The_overlay_network"></a>The overlay network</h6>
<p>In overlay/chunk.h / cpp are defined three classes: <strong>ChunkInfo:</strong> A <span style="border-top-width: 0px; border-right-width: 0px; border-bottom-width: 1px; border-left-width: 0px; border-color: #dddddd; border-style: solid;">ChunkInfo<a style="text-decoration: none; color: #0066cc; background-color: transparent; margin-left: 1px;" title="Create this topic" rel="nofollow" href="http://netgroup.uniroma2.it/twiki/bin/edit.cgi/Netgroup/ChunkInfo?topicparent=Netgroup.SimulatorGuide">?</a></span> object (and only one!) must be created for each different chunk passed to the overlay network. It collects some information such the Time it was created in the origin node or the chunkID. Every different <span style="border-top-width: 0px; border-right-width: 0px; border-bottom-width: 1px; border-left-width: 0px; border-color: #dddddd; border-style: solid;">ChunkInfo<a style="text-decoration: none; color: #0066cc; background-color: transparent; margin-left: 1px;" title="Create this topic" rel="nofollow" href="http://netgroup.uniroma2.it/twiki/bin/edit.cgi/Netgroup/ChunkInfo?topicparent=Netgroup.SimulatorGuide">?</a></span> has different ID. <strong>Content:</strong> This class includes a static map of all the chunkInfo created during the simulation, and offers methods to find from a chunkId its corrispondent <span style="border-top-width: 0px; border-right-width: 0px; border-bottom-width: 1px; border-left-width: 0px; border-color: #dddddd; border-style: solid;">ChunkInfo<a style="text-decoration: none; color: #0066cc; background-color: transparent; margin-left: 1px;" title="Create this topic" rel="nofollow" href="http://netgroup.uniroma2.it/twiki/bin/edit.cgi/Netgroup/ChunkInfo?topicparent=Netgroup.SimulatorGuide">?</a></span> object, to get the Last and the First <span style="border-top-width: 0px; border-right-width: 0px; border-bottom-width: 1px; border-left-width: 0px; border-color: #dddddd; border-style: solid;">ChunkInfo<a style="text-decoration: none; color: #0066cc; background-color: transparent; margin-left: 1px;" title="Create this topic" rel="nofollow" href="http://netgroup.uniroma2.it/twiki/bin/edit.cgi/Netgroup/ChunkInfo?topicparent=Netgroup.SimulatorGuide">?</a></span> created. <strong>Chunk:</strong> Every node has a finite lenght list of downloaded chunks as a list of Chunk objects so there will be more Chunk object with the same ID. Every Chunk store some parameters needed for the Network part.</p>
<p style="margin-top: 1em; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; background-color: transparent;">Every node, when they are created, call a connect method and before they are disconnected they call a disconnect method. You can customize the body of these methods (included in files &#8220;customize/Node.cpp&#8221;) to evaluate your own streaming argument. These methos can call other methods, put some events in the Calendar, write something to the tracefile. For creating a Node, you can simple do Node(unsigned int a, unsigned int b) , where a is the upload bandwidth of the node (in kbps) and b is the download bandwidth (in kbps). In this example every node (except the Origin), starts to download 4 chunk from the origin node, in sequence.</p>
<p style="margin-top: 1em; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; background-color: transparent;">
<pre style="width: auto; margin-top: 1em; margin-right: 0px; margin-bottom: 1em; margin-left: 0px; color: #3a0075; overflow-x: scroll; overflow-y: scroll;">void Node::connect(bool isMeTheOrigin){
   Tracer::write(std::string("NODE_CREATION ") + getNodeIdAsString(),NODE_CREATION);
   if (!isMeTheOrigin) {
      const int chunk_n = 4;
      std::map&lt;unsigned int, ChunkInfo*&gt;::iterator it = Content::mContentInfo.end();
      assert(Content::mContentInfo.size() &gt; chunk_n ); // You haven't created enought chunk
      for (int i = 0; i &lt;=chunk_n; i++)
         it--;
      for (int i = 1; i &lt;=chunk_n; i++) {
         it++;
         Calendar::put(new StartDownload(Node::mNodes[ORIGIN],this, it-&gt;second ,(Calendar::time()+i)) );
      }
   }
}</pre>
<p>If the node is created at the Time &#8220;30&#8243; and the last created <span style="border-top-width: 0px; border-right-width: 0px; border-bottom-width: 1px; border-left-width: 0px; border-color: #dddddd; border-style: solid;">ChunkInfo<a style="text-decoration: none; color: #0066cc; background-color: transparent; margin-left: 1px;" title="Create this topic" rel="nofollow" href="http://netgroup.uniroma2.it/twiki/bin/edit.cgi/Netgroup/ChunkInfo?topicparent=Netgroup.SimulatorGuide">?</a></span> the 21, the node will start downloading chunk 17 at time 31, the chunk 18 at time 32,the chunk 19 at time 33 and the chunk 20 at time 33.</p>
<p style="margin-top: 1em; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; background-color: transparent;">Several methods of Node are inheredit from <span style="border-top-width: 0px; border-right-width: 0px; border-bottom-width: 1px; border-left-width: 0px; border-color: #dddddd; border-style: solid;">BaseNode<a style="text-decoration: none; color: #0066cc; background-color: transparent; margin-left: 1px;" title="Create this topic" rel="nofollow" href="http://netgroup.uniroma2.it/twiki/bin/edit.cgi/Netgroup/BaseNode?topicparent=Netgroup.SimulatorGuide">?</a></span> . These are:</p>
<p style="margin-top: 1em; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; background-color: transparent;">
<ul style="margin-top: 0px; background-color: transparent;">
<li style="background-color: transparent; line-height: 1.4em;">getNodeId / getNodeIdAsString: return an the Node Id</li>
<li style="background-color: transparent; line-height: 1.4em;">getOrigin: return a pointer to the Origin node</li>
<li style="background-color: transparent; line-height: 1.4em;">getBwUp: return the upload bandwidth of the node (in kbps)</li>
<li style="background-color: transparent; line-height: 1.4em;">getBwDown: return the download bandwidth of the node (in kbps)</li>
<li style="background-color: transparent; line-height: 1.4em;"><span style="border-top-width: 0px; border-right-width: 0px; border-bottom-width: 1px; border-left-width: 0px; border-color: #dddddd; border-style: solid;">StartDownload<a style="text-decoration: none; color: #0066cc; background-color: transparent; margin-left: 1px;" title="Create this topic" rel="nofollow" href="http://netgroup.uniroma2.it/twiki/bin/edit.cgi/Netgroup/StartDownload?topicparent=Netgroup.SimulatorGuide">?</a></span> : the node start to Download a chunk. It accepts as parameters a pointer to the uploader Node, a pointer to Chunkinfo, and optionally the first byte of the chunk and the last byte. These two last parameters allow to implements algorithms with chunks resume logics.</li>
</ul>
<p style="margin-top: 1em; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; background-color: transparent;">There is also a static map &#8211; called mNodes &#8211; that associates every node created during the simulation with their ID.</p>
<p style="margin-top: 1em; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; background-color: transparent;">When you start a Download of a chunk, the network abstract layer will be responsable to calculate the end of this download (triggering <span style="border-top-width: 0px; border-right-width: 0px; border-bottom-width: 1px; border-left-width: 0px; border-color: #dddddd; border-style: solid;">EndDownload<a style="text-decoration: none; color: #0066cc; background-color: transparent; margin-left: 1px;" title="Create this topic" rel="nofollow" href="http://netgroup.uniroma2.it/twiki/bin/edit.cgi/Netgroup/EndDownload?topicparent=Netgroup.SimulatorGuide">?</a></span> event) and to dynicamic recalculate the end of the this download every time the network status will change. Obviously in case of Node distructions, its uplink and downlink connection will be removed.</p>
<p style="margin-top: 1em; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; background-color: transparent;">
<p style="margin-top: 1em; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; background-color: transparent;">
<p style="margin-top: 1em; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; background-color: transparent;">
<p style="margin-top: 1em; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; background-color: transparent;">
<p style="margin-top: 1em; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; background-color: transparent;">
<p style="margin-top: 1em; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; background-color: transparent;">
<h6 style="line-height: 13px; padding-top: 0.1em; padding-right: 5px; padding-bottom: 0.1em; padding-left: 5px; margin-top: 1em; margin-right: -5px; margin-bottom: 0.35em; margin-left: -5px; font-weight: normal; font-size: 13px; display: block; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 1px; border-left-width: 0px; height: auto; background-color: transparent; color: #333399; border-color: #e9e4d2; border-style: solid;"><a name="The_Network_part"></a>The Network part</h6>
<p style="margin-top: 1em; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; background-color: transparent;">
<p style="margin-top: 1em; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; background-color: transparent;">There is not a really need for the user of this simulator to deeply know how the network part works. It allows you to simulate with a Max Min Fair approach, a TCP connection for the downloading of a chunk. Network reconfiguration mechanisms start automatically every <span style="border-top-width: 0px; border-right-width: 0px; border-bottom-width: 1px; border-left-width: 0px; border-color: #dddddd; border-style: solid;">StartDownload<a style="text-decoration: none; color: #0066cc; background-color: transparent; margin-left: 1px;" title="Create this topic" rel="nofollow" href="http://netgroup.uniroma2.it/twiki/bin/edit.cgi/Netgroup/StartDownload?topicparent=Netgroup.SimulatorGuide">?</a></span> function and every <span style="border-top-width: 0px; border-right-width: 0px; border-bottom-width: 1px; border-left-width: 0px; border-color: #dddddd; border-style: solid;">EndDownload<a style="text-decoration: none; color: #0066cc; background-color: transparent; margin-left: 1px;" title="Create this topic" rel="nofollow" href="http://netgroup.uniroma2.it/twiki/bin/edit.cgi/Netgroup/EndDownload?topicparent=Netgroup.SimulatorGuide">?</a></span> events.</p>
<p style="margin-top: 1em; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; background-color: transparent;">
<p style="margin-top: 1em; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; background-color: transparent;">
<p style="margin-top: 1em; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; background-color: transparent;">
<h4 style="line-height: 17px; padding-top: 0.1em; padding-right: 5px; padding-bottom: 0.1em; padding-left: 5px; margin-top: 1em; margin-right: -5px; margin-bottom: 0.35em; margin-left: -5px; font-weight: normal; font-size: 17px; display: block; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 1px; border-left-width: 0px; height: auto; background-color: transparent; color: #333399; border-color: #e9e4d2; border-style: solid;"><a name="Log_Model"></a>Log Model</h4>
<p>OPSS produces plain text ascii log in a file whose name is specified in the <em>TRACE_FILE</em> variable. In order to write something on the trace file, you need to give the following command:</p>
<pre style="width: auto; margin-top: 1em; margin-right: 0px; margin-bottom: 1em; margin-left: 0px; color: #3a0075; overflow-x: scroll; overflow-y: scroll;">Tracer::write(std::string("YOUR STRING ") , TYPE_OF_TRACE);</pre>
<p>where TYPE_OF_TRACE can be one of the following constant:</p>
<pre style="width: auto; margin-top: 1em; margin-right: 0px; margin-bottom: 1em; margin-left: 0px; color: #3a0075; overflow-x: scroll; overflow-y: scroll;">NODE_CREATION
NODE_DESTRUCTION
CHUNK_CREATION
START_DOWNLOAD
END_DOWNLOAD
PLAY_CHUNK
SIMULATION_INFO
DEBUG
USER_DEFINED
SIGNALLING
MESHINFO</pre>
<p style="margin-top: 1em; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; background-color: transparent;">In the Global.h file, you can tells the simulator which categories of events to trace. For example if you write:</p>
<pre style="width: auto; margin-top: 1em; margin-right: 0px; margin-bottom: 1em; margin-left: 0px; color: #3a0075; overflow-x: scroll; overflow-y: scroll;">#define LOGLEVEL LOG_MESHINFO+LOG_END_DOWNLOAD</pre>
<p style="margin-top: 1em; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; background-color: transparent;">You will enable the log only of the MESHINFO and END_DOWNLOAD events.</p>
<p style="margin-top: 1em; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; background-color: transparent;">Each line in the log file follows the following pattern:</p>
<p style="margin-top: 1em; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; background-color: transparent;">TIME_OF_THE_EVENT NAME_OF_THE_EVENT ADDITIONAL_PARAMETERS &#8230;</p>
<p style="margin-top: 1em; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; background-color: transparent;">Actually we use the following conventions for trace events&#8217; additional parameters:</p>
<p style="margin-top: 1em; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; background-color: transparent;"><strong>END_DOWNLOAD</strong></p>
<p style="margin-top: 1em; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; background-color: transparent;">TIME END_DOWNLOAD DOWNLOADER_ID DOWNLOADER_BANDWIDTH_PROFILE UPLOADER_ID UPLOADER_BANDWIDTH_PROFILE CHUNK_ID CHUNK_CREATION_TIME DOWNLOAD_START_TIME (other less important staff)</p>
<p style="margin-top: 1em; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; background-color: transparent;"><strong>NODE_CREATION</strong></p>
<p style="margin-top: 1em; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; background-color: transparent;">TIME NODE_CREATION ID_NODE</p>
<p style="margin-top: 1em; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; background-color: transparent;"><strong>NODE_DESTRUCTION</strong></p>
<p style="margin-top: 1em; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; background-color: transparent;">TIME NODE_DESTRUCTION ID_NODE</p>
<p style="margin-top: 1em; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; background-color: transparent;">
<p style="margin-top: 1em; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; background-color: transparent;">The tracer class is a static class, and the writing procedure is performed on a separate thread.</p>
<p></span></span></div>
</div>




</div>

<div id="sidebar">


<h2>Pages</h2>
<ul>
<li class="page_item page-item-5"><a href="http://opss.sourceforge.net" title="Main Page">Main Page</a></li>
<li class="page_item page-item-13 current_page_ancestor current_page_parent"><a href="http://opss.sourceforge.net/documentation/" title="Documentation">Documentation</a>
<ul>
	<li class="page_item page-item-24"><a href="http://opss.sourceforge.net/documentation/quick-start-tutorial/" title="Quick Start Tutorial">Quick Start Tutorial</a></li>
	<li class="page_item page-item-20"><a href="http://opss.sourceforge.net/documentation/papers/" title="Papers">Papers</a></li>
	<li class="page_item page-item-38 current_page_item"><a href="http://opss.sourceforge.net/documentation/simulator-handbook/" title="Simulator Handbook">Simulator Handbook</a></li>
</ul>
</li>
<li class="page_item page-item-26"><a href="http://opss.sourceforge.net/people/" title="People">People</a></li>
<li class="page_item page-item-29"><a href="http://opss.sourceforge.net/code/" title="Code">Code</a>
<ul>
	<li class="page_item page-item-15"><a href="http://opss.sourceforge.net/code/download/" title="Download">Download</a></li>
	<li class="page_item page-item-31"><a href="http://opss.sourceforge.net/code/browse-source/" title="Browse Source">Browse Source</a></li>
</ul>
</li>
<li class="page_item page-item-46"><a href="http://opss.sourceforge.net/support/" title="Support">Support</a></li>
</ul>
<!--
<h2>Categories</h2>
<ul>
	<li class="cat-item cat-item-1"><a href="http://opss.sourceforge.net/http:/opss.sourceforge.net/category/uncategorized/" title="View all posts filed under Uncategorized">Uncategorized</a> (1)
</li>
</ul>

<h2>Popular tags</h2>
<p>
</p>
-->

<h2>Search</h2>
<form method="get" id="searchform" action="/index.php">
<div class="searchbox">
<label for="s">Find:</label>
<input type="text" value="" name="s" id="s" size="14" />
<input type="hidden" id="searchsubmit" value="Search" />
</div>
</form>
</div><div id="footer">
<p>&copy; 2012 OPSS | <a href="http://opss.sourceforge.net/feed/">Entries (RSS)</a> | <a href="http://opss.sourceforge.net/comments/feed/">Comments (RSS)</a> | <a href="http://opss.sourceforge.net/wp-login.php">Log in</a><br />
<span>Powered by <a href="http://wordpress.org/">WordPress</a> | <a href="http://andreasviklund.com/wordpress-themes/">Theme design</a> by <a href="http://andreasviklund.com/" title="Original theme design by Andreas Viklund">Andreas Viklund</a></span></p>
</div>
</div>
</body>
</html>